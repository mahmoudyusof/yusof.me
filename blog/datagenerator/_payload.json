[{"data":1,"prerenderedAt":3058},["ShallowReactive",2],{"my-page":3},{"_path":4,"_dir":5,"_draft":6,"_partial":6,"_locale":7,"title":8,"description":9,"project":10,"slug":11,"type":12,"image":13,"url":14,"date":15,"body":16,"_type":3053,"_id":3054,"_source":3055,"_file":3056,"_extension":3057},"/blog/datagenerator","blog",false,"","Data Generators In Tensorflow","explaining how to load batches of data into memory instead of the entire dataset for more effeciency","facial-keypoint-detection","data-generator","article","/memory.jpg","https://mahmoudyusof.github.io/facial-keypoint-detection/data-generator/","2020-05-25",{"type":17,"children":18,"toc":3045},"root",[19,28,32,39,59,65,70,98,104,114,120,122,239,242,247,252,267,272,285,738,741,754,759,867,870,890,970,973,1013,1023,1033,1520,1523,1536,1814,1817,1823,3003,3006,3016,3019,3029,3039],{"type":20,"tag":21,"props":22,"children":24},"element","h1",{"id":23},"how-to-use-data-generators-in-tensorflow",[25],{"type":26,"value":27},"text","How to use data generators in tensorflow",{"type":20,"tag":29,"props":30,"children":31},"hr",{},[],{"type":20,"tag":33,"props":34,"children":36},"h2",{"id":35},"why",[37],{"type":26,"value":38},"Why ?",{"type":20,"tag":40,"props":41,"children":42},"p",{},[43,45,51,53,57],{"type":26,"value":44},"Believe it or not, but loading the entire dataset in memory is ",{"type":20,"tag":46,"props":47,"children":48},"strong",{},[49],{"type":26,"value":50},"NOT",{"type":26,"value":52}," the best idea.",{"type":20,"tag":54,"props":55,"children":56},"br",{},[],{"type":26,"value":58},"\nIf you're dealing with a small dataset, that might work, but that is just a waste of resources, and worse if you're working on a huge dataset like the imageNet dataset, this won't work at all.",{"type":20,"tag":33,"props":60,"children":62},{"id":61},"how",[63],{"type":26,"value":64},"HOW ?",{"type":20,"tag":40,"props":66,"children":67},{},[68],{"type":26,"value":69},"Python generators are lazy which means they are iterables that give you the data upon request, unlike regular lists that just store the data in memory all the time.",{"type":20,"tag":40,"props":71,"children":72},{},[73,75,82,84,93,96],{"type":26,"value":74},"tensorflow keras has a ",{"type":20,"tag":76,"props":77,"children":79},"code",{"className":78},[],[80],{"type":26,"value":81},"Sequence",{"type":26,"value":83}," class that can be used for this purpose. ",{"type":20,"tag":85,"props":86,"children":90},"a",{"className":87,"href":89},[88],"mdlink","https://www.tensorflow.org/api_docs/python/tf/keras/utils/Sequence",[91],{"type":26,"value":92},"Sequence Class API Reference",{"type":20,"tag":54,"props":94,"children":95},{},[],{"type":26,"value":97},"\nlet's jump into it",{"type":20,"tag":33,"props":99,"children":101},{"id":100},"scenario",[102],{"type":26,"value":103},"Scenario",{"type":20,"tag":40,"props":105,"children":106},{},[107,109,112],{"type":26,"value":108},"Working with images is a good example for this, so let's say that you have pictures of objects that you need to localize,",{"type":20,"tag":54,"props":110,"children":111},{},[],{"type":26,"value":113},"\nSo your features are images and labels are (x, y, h, w) for coordinate and dimensions of the containing box, and the labels and image names are stored in a csv file.",{"type":20,"tag":33,"props":115,"children":117},{"id":116},"data",[118],{"type":26,"value":119},"Data",{"type":26,"value":121},"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",{"type":20,"tag":123,"props":124,"children":125},"table",{},[126,160],{"type":20,"tag":127,"props":128,"children":129},"thead",{},[130],{"type":20,"tag":131,"props":132,"children":133},"tr",{},[134,140,145,150,155],{"type":20,"tag":135,"props":136,"children":137},"th",{},[138],{"type":26,"value":139},"image_file    ",{"type":20,"tag":135,"props":141,"children":142},{},[143],{"type":26,"value":144},"x    ",{"type":20,"tag":135,"props":146,"children":147},{},[148],{"type":26,"value":149},"y    ",{"type":20,"tag":135,"props":151,"children":152},{},[153],{"type":26,"value":154},"w    ",{"type":20,"tag":135,"props":156,"children":157},{},[158],{"type":26,"value":159},"h    ",{"type":20,"tag":161,"props":162,"children":163},"tbody",{},[164,192,216],{"type":20,"tag":131,"props":165,"children":166},{},[167,173,178,183,188],{"type":20,"tag":168,"props":169,"children":170},"td",{},[171],{"type":26,"value":172},"file1.png",{"type":20,"tag":168,"props":174,"children":175},{},[176],{"type":26,"value":177},"10",{"type":20,"tag":168,"props":179,"children":180},{},[181],{"type":26,"value":182},"20",{"type":20,"tag":168,"props":184,"children":185},{},[186],{"type":26,"value":187},"50",{"type":20,"tag":168,"props":189,"children":190},{},[191],{"type":26,"value":187},{"type":20,"tag":131,"props":193,"children":194},{},[195,200,204,208,212],{"type":20,"tag":168,"props":196,"children":197},{},[198],{"type":26,"value":199},"...",{"type":20,"tag":168,"props":201,"children":202},{},[203],{"type":26,"value":199},{"type":20,"tag":168,"props":205,"children":206},{},[207],{"type":26,"value":199},{"type":20,"tag":168,"props":209,"children":210},{},[211],{"type":26,"value":199},{"type":20,"tag":168,"props":213,"children":214},{},[215],{"type":26,"value":199},{"type":20,"tag":131,"props":217,"children":218},{},[219,223,227,231,235],{"type":20,"tag":168,"props":220,"children":221},{},[222],{"type":26,"value":199},{"type":20,"tag":168,"props":224,"children":225},{},[226],{"type":26,"value":199},{"type":20,"tag":168,"props":228,"children":229},{},[230],{"type":26,"value":199},{"type":20,"tag":168,"props":232,"children":233},{},[234],{"type":26,"value":199},{"type":20,"tag":168,"props":236,"children":237},{},[238],{"type":26,"value":199},{"type":20,"tag":29,"props":240,"children":241},{},[],{"type":20,"tag":33,"props":243,"children":244},{"id":76},[245],{"type":26,"value":246},"Code",{"type":20,"tag":40,"props":248,"children":249},{},[250],{"type":26,"value":251},"Let's define an initializer, the initializer is going to take the information needed to get the data such as:",{"type":20,"tag":253,"props":254,"children":255},"ul",{},[256,262],{"type":20,"tag":257,"props":258,"children":259},"li",{},[260],{"type":26,"value":261},"The csv file",{"type":20,"tag":257,"props":263,"children":264},{},[265],{"type":26,"value":266},"The directory containing all of the images",{"type":20,"tag":40,"props":268,"children":269},{},[270],{"type":26,"value":271},"It will also take the output shape of the batch",{"type":20,"tag":253,"props":273,"children":274},{},[275,280],{"type":20,"tag":257,"props":276,"children":277},{},[278],{"type":26,"value":279},"The output size of each image",{"type":20,"tag":257,"props":281,"children":282},{},[283],{"type":26,"value":284},"The batch size",{"type":20,"tag":286,"props":287,"children":291},"pre",{"className":288,"code":289,"language":290,"meta":7,"style":7},"language-python shiki shiki-themes dark-plus github-dark","import numpy as np\nimport pandas as pd\nimport matplotlib.image as mpimg\n\nfrom tensorflow.keras.utils import Sequence\n\nclass DataGenerator(Sequence):\n\n  def __init__(self, csv_file, base_dir, output_size, shuffle=False, batch_size=10):\n  \"\"\"\n  Initializes a data generator object\n    :param csv_file: file in which image names and numeric labels are stored\n    :param base_dir: the directory in which all images are stored\n    :param output_size: image output size after preprocessing\n    :param shuffle: shuffle the data after each epoch\n    :param batch_size: The size of each batch returned by __getitem__\n  \"\"\"\n    self.df = pd.read_csv(csv_file)\n    self.base_dir = base_dir\n    self.output_size = output_size\n    self.shuffle = shuffle\n    self.batch_size = batch_size\n    self.on_epoch_end()\n\n\n","python",[292],{"type":20,"tag":76,"props":293,"children":294},{"__ignoreMap":7},[295,323,345,367,377,400,408,438,446,542,552,561,570,579,588,597,606,614,637,659,681,703,725],{"type":20,"tag":296,"props":297,"children":300},"span",{"class":298,"line":299},"line",1,[301,307,313,318],{"type":20,"tag":296,"props":302,"children":304},{"style":303},"--shiki-default:#C586C0;--shiki-dark:#F97583",[305],{"type":26,"value":306},"import",{"type":20,"tag":296,"props":308,"children":310},{"style":309},"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8",[311],{"type":26,"value":312}," numpy ",{"type":20,"tag":296,"props":314,"children":315},{"style":303},[316],{"type":26,"value":317},"as",{"type":20,"tag":296,"props":319,"children":320},{"style":309},[321],{"type":26,"value":322}," np\n",{"type":20,"tag":296,"props":324,"children":326},{"class":298,"line":325},2,[327,331,336,340],{"type":20,"tag":296,"props":328,"children":329},{"style":303},[330],{"type":26,"value":306},{"type":20,"tag":296,"props":332,"children":333},{"style":309},[334],{"type":26,"value":335}," pandas ",{"type":20,"tag":296,"props":337,"children":338},{"style":303},[339],{"type":26,"value":317},{"type":20,"tag":296,"props":341,"children":342},{"style":309},[343],{"type":26,"value":344}," pd\n",{"type":20,"tag":296,"props":346,"children":348},{"class":298,"line":347},3,[349,353,358,362],{"type":20,"tag":296,"props":350,"children":351},{"style":303},[352],{"type":26,"value":306},{"type":20,"tag":296,"props":354,"children":355},{"style":309},[356],{"type":26,"value":357}," matplotlib.image ",{"type":20,"tag":296,"props":359,"children":360},{"style":303},[361],{"type":26,"value":317},{"type":20,"tag":296,"props":363,"children":364},{"style":309},[365],{"type":26,"value":366}," mpimg\n",{"type":20,"tag":296,"props":368,"children":370},{"class":298,"line":369},4,[371],{"type":20,"tag":296,"props":372,"children":374},{"emptyLinePlaceholder":373},true,[375],{"type":26,"value":376},"\n",{"type":20,"tag":296,"props":378,"children":380},{"class":298,"line":379},5,[381,386,391,395],{"type":20,"tag":296,"props":382,"children":383},{"style":303},[384],{"type":26,"value":385},"from",{"type":20,"tag":296,"props":387,"children":388},{"style":309},[389],{"type":26,"value":390}," tensorflow.keras.utils ",{"type":20,"tag":296,"props":392,"children":393},{"style":303},[394],{"type":26,"value":306},{"type":20,"tag":296,"props":396,"children":397},{"style":309},[398],{"type":26,"value":399}," Sequence\n",{"type":20,"tag":296,"props":401,"children":403},{"class":298,"line":402},6,[404],{"type":20,"tag":296,"props":405,"children":406},{"emptyLinePlaceholder":373},[407],{"type":26,"value":376},{"type":20,"tag":296,"props":409,"children":411},{"class":298,"line":410},7,[412,418,424,429,433],{"type":20,"tag":296,"props":413,"children":415},{"style":414},"--shiki-default:#569CD6;--shiki-dark:#F97583",[416],{"type":26,"value":417},"class",{"type":20,"tag":296,"props":419,"children":421},{"style":420},"--shiki-default:#4EC9B0;--shiki-dark:#B392F0",[422],{"type":26,"value":423}," DataGenerator",{"type":20,"tag":296,"props":425,"children":426},{"style":309},[427],{"type":26,"value":428},"(",{"type":20,"tag":296,"props":430,"children":431},{"style":420},[432],{"type":26,"value":81},{"type":20,"tag":296,"props":434,"children":435},{"style":309},[436],{"type":26,"value":437},"):\n",{"type":20,"tag":296,"props":439,"children":441},{"class":298,"line":440},8,[442],{"type":20,"tag":296,"props":443,"children":444},{"emptyLinePlaceholder":373},[445],{"type":26,"value":376},{"type":20,"tag":296,"props":447,"children":449},{"class":298,"line":448},9,[450,455,461,465,471,476,481,485,490,494,499,503,508,514,520,524,529,533,538],{"type":20,"tag":296,"props":451,"children":452},{"style":414},[453],{"type":26,"value":454},"  def",{"type":20,"tag":296,"props":456,"children":458},{"style":457},"--shiki-default:#DCDCAA;--shiki-dark:#79B8FF",[459],{"type":26,"value":460}," __init__",{"type":20,"tag":296,"props":462,"children":463},{"style":309},[464],{"type":26,"value":428},{"type":20,"tag":296,"props":466,"children":468},{"style":467},"--shiki-default:#9CDCFE;--shiki-dark:#E1E4E8",[469],{"type":26,"value":470},"self",{"type":20,"tag":296,"props":472,"children":473},{"style":309},[474],{"type":26,"value":475},", ",{"type":20,"tag":296,"props":477,"children":478},{"style":467},[479],{"type":26,"value":480},"csv_file",{"type":20,"tag":296,"props":482,"children":483},{"style":309},[484],{"type":26,"value":475},{"type":20,"tag":296,"props":486,"children":487},{"style":467},[488],{"type":26,"value":489},"base_dir",{"type":20,"tag":296,"props":491,"children":492},{"style":309},[493],{"type":26,"value":475},{"type":20,"tag":296,"props":495,"children":496},{"style":467},[497],{"type":26,"value":498},"output_size",{"type":20,"tag":296,"props":500,"children":501},{"style":309},[502],{"type":26,"value":475},{"type":20,"tag":296,"props":504,"children":505},{"style":467},[506],{"type":26,"value":507},"shuffle",{"type":20,"tag":296,"props":509,"children":511},{"style":510},"--shiki-default:#D4D4D4;--shiki-dark:#F97583",[512],{"type":26,"value":513},"=",{"type":20,"tag":296,"props":515,"children":517},{"style":516},"--shiki-default:#569CD6;--shiki-dark:#79B8FF",[518],{"type":26,"value":519},"False",{"type":20,"tag":296,"props":521,"children":522},{"style":309},[523],{"type":26,"value":475},{"type":20,"tag":296,"props":525,"children":526},{"style":467},[527],{"type":26,"value":528},"batch_size",{"type":20,"tag":296,"props":530,"children":531},{"style":510},[532],{"type":26,"value":513},{"type":20,"tag":296,"props":534,"children":536},{"style":535},"--shiki-default:#B5CEA8;--shiki-dark:#79B8FF",[537],{"type":26,"value":177},{"type":20,"tag":296,"props":539,"children":540},{"style":309},[541],{"type":26,"value":437},{"type":20,"tag":296,"props":543,"children":545},{"class":298,"line":544},10,[546],{"type":20,"tag":296,"props":547,"children":549},{"style":548},"--shiki-default:#CE9178;--shiki-dark:#9ECBFF",[550],{"type":26,"value":551},"  \"\"\"\n",{"type":20,"tag":296,"props":553,"children":555},{"class":298,"line":554},11,[556],{"type":20,"tag":296,"props":557,"children":558},{"style":548},[559],{"type":26,"value":560},"  Initializes a data generator object\n",{"type":20,"tag":296,"props":562,"children":564},{"class":298,"line":563},12,[565],{"type":20,"tag":296,"props":566,"children":567},{"style":548},[568],{"type":26,"value":569},"    :param csv_file: file in which image names and numeric labels are stored\n",{"type":20,"tag":296,"props":571,"children":573},{"class":298,"line":572},13,[574],{"type":20,"tag":296,"props":575,"children":576},{"style":548},[577],{"type":26,"value":578},"    :param base_dir: the directory in which all images are stored\n",{"type":20,"tag":296,"props":580,"children":582},{"class":298,"line":581},14,[583],{"type":20,"tag":296,"props":584,"children":585},{"style":548},[586],{"type":26,"value":587},"    :param output_size: image output size after preprocessing\n",{"type":20,"tag":296,"props":589,"children":591},{"class":298,"line":590},15,[592],{"type":20,"tag":296,"props":593,"children":594},{"style":548},[595],{"type":26,"value":596},"    :param shuffle: shuffle the data after each epoch\n",{"type":20,"tag":296,"props":598,"children":600},{"class":298,"line":599},16,[601],{"type":20,"tag":296,"props":602,"children":603},{"style":548},[604],{"type":26,"value":605},"    :param batch_size: The size of each batch returned by __getitem__\n",{"type":20,"tag":296,"props":607,"children":609},{"class":298,"line":608},17,[610],{"type":20,"tag":296,"props":611,"children":612},{"style":548},[613],{"type":26,"value":551},{"type":20,"tag":296,"props":615,"children":617},{"class":298,"line":616},18,[618,623,628,632],{"type":20,"tag":296,"props":619,"children":620},{"style":516},[621],{"type":26,"value":622},"    self",{"type":20,"tag":296,"props":624,"children":625},{"style":309},[626],{"type":26,"value":627},".df ",{"type":20,"tag":296,"props":629,"children":630},{"style":510},[631],{"type":26,"value":513},{"type":20,"tag":296,"props":633,"children":634},{"style":309},[635],{"type":26,"value":636}," pd.read_csv(csv_file)\n",{"type":20,"tag":296,"props":638,"children":640},{"class":298,"line":639},19,[641,645,650,654],{"type":20,"tag":296,"props":642,"children":643},{"style":516},[644],{"type":26,"value":622},{"type":20,"tag":296,"props":646,"children":647},{"style":309},[648],{"type":26,"value":649},".base_dir ",{"type":20,"tag":296,"props":651,"children":652},{"style":510},[653],{"type":26,"value":513},{"type":20,"tag":296,"props":655,"children":656},{"style":309},[657],{"type":26,"value":658}," base_dir\n",{"type":20,"tag":296,"props":660,"children":662},{"class":298,"line":661},20,[663,667,672,676],{"type":20,"tag":296,"props":664,"children":665},{"style":516},[666],{"type":26,"value":622},{"type":20,"tag":296,"props":668,"children":669},{"style":309},[670],{"type":26,"value":671},".output_size ",{"type":20,"tag":296,"props":673,"children":674},{"style":510},[675],{"type":26,"value":513},{"type":20,"tag":296,"props":677,"children":678},{"style":309},[679],{"type":26,"value":680}," output_size\n",{"type":20,"tag":296,"props":682,"children":684},{"class":298,"line":683},21,[685,689,694,698],{"type":20,"tag":296,"props":686,"children":687},{"style":516},[688],{"type":26,"value":622},{"type":20,"tag":296,"props":690,"children":691},{"style":309},[692],{"type":26,"value":693},".shuffle ",{"type":20,"tag":296,"props":695,"children":696},{"style":510},[697],{"type":26,"value":513},{"type":20,"tag":296,"props":699,"children":700},{"style":309},[701],{"type":26,"value":702}," shuffle\n",{"type":20,"tag":296,"props":704,"children":706},{"class":298,"line":705},22,[707,711,716,720],{"type":20,"tag":296,"props":708,"children":709},{"style":516},[710],{"type":26,"value":622},{"type":20,"tag":296,"props":712,"children":713},{"style":309},[714],{"type":26,"value":715},".batch_size ",{"type":20,"tag":296,"props":717,"children":718},{"style":510},[719],{"type":26,"value":513},{"type":20,"tag":296,"props":721,"children":722},{"style":309},[723],{"type":26,"value":724}," batch_size\n",{"type":20,"tag":296,"props":726,"children":728},{"class":298,"line":727},23,[729,733],{"type":20,"tag":296,"props":730,"children":731},{"style":516},[732],{"type":26,"value":622},{"type":20,"tag":296,"props":734,"children":735},{"style":309},[736],{"type":26,"value":737},".on_epoch_end()\n",{"type":20,"tag":29,"props":739,"children":740},{},[],{"type":20,"tag":40,"props":742,"children":743},{},[744,746,752],{"type":26,"value":745},"Now let's define some special methods starting with the one called in the initializer ",{"type":20,"tag":76,"props":747,"children":749},{"className":748},[],[750],{"type":26,"value":751},"on_epoch_end()",{"type":26,"value":753}," that is called after each epoch as the name may suggest, duh!",{"type":20,"tag":40,"props":755,"children":756},{},[757],{"type":26,"value":758},"We call this method in the initializer because we need the indeces attribute to be set at the begining of the first epoch, otherwise we will get an error telling us that the class has no attribute \"indecies\"",{"type":20,"tag":286,"props":760,"children":762},{"className":288,"code":761,"language":290,"meta":7,"style":7},"def on_epoch_end(self):\n  self.indices = np.arange(len(self.df))\n  if self.shuffle:\n    np.random.shuffle(self.indices)\n\n\n",[763],{"type":20,"tag":76,"props":764,"children":765},{"__ignoreMap":7},[766,792,832,850],{"type":20,"tag":296,"props":767,"children":768},{"class":298,"line":299},[769,774,780,784,788],{"type":20,"tag":296,"props":770,"children":771},{"style":414},[772],{"type":26,"value":773},"def",{"type":20,"tag":296,"props":775,"children":777},{"style":776},"--shiki-default:#DCDCAA;--shiki-dark:#B392F0",[778],{"type":26,"value":779}," on_epoch_end",{"type":20,"tag":296,"props":781,"children":782},{"style":309},[783],{"type":26,"value":428},{"type":20,"tag":296,"props":785,"children":786},{"style":467},[787],{"type":26,"value":470},{"type":20,"tag":296,"props":789,"children":790},{"style":309},[791],{"type":26,"value":437},{"type":20,"tag":296,"props":793,"children":794},{"class":298,"line":325},[795,800,805,809,814,819,823,827],{"type":20,"tag":296,"props":796,"children":797},{"style":516},[798],{"type":26,"value":799},"  self",{"type":20,"tag":296,"props":801,"children":802},{"style":309},[803],{"type":26,"value":804},".indices ",{"type":20,"tag":296,"props":806,"children":807},{"style":510},[808],{"type":26,"value":513},{"type":20,"tag":296,"props":810,"children":811},{"style":309},[812],{"type":26,"value":813}," np.arange(",{"type":20,"tag":296,"props":815,"children":816},{"style":457},[817],{"type":26,"value":818},"len",{"type":20,"tag":296,"props":820,"children":821},{"style":309},[822],{"type":26,"value":428},{"type":20,"tag":296,"props":824,"children":825},{"style":516},[826],{"type":26,"value":470},{"type":20,"tag":296,"props":828,"children":829},{"style":309},[830],{"type":26,"value":831},".df))\n",{"type":20,"tag":296,"props":833,"children":834},{"class":298,"line":347},[835,840,845],{"type":20,"tag":296,"props":836,"children":837},{"style":303},[838],{"type":26,"value":839},"  if",{"type":20,"tag":296,"props":841,"children":842},{"style":516},[843],{"type":26,"value":844}," self",{"type":20,"tag":296,"props":846,"children":847},{"style":309},[848],{"type":26,"value":849},".shuffle:\n",{"type":20,"tag":296,"props":851,"children":852},{"class":298,"line":369},[853,858,862],{"type":20,"tag":296,"props":854,"children":855},{"style":309},[856],{"type":26,"value":857},"    np.random.shuffle(",{"type":20,"tag":296,"props":859,"children":860},{"style":516},[861],{"type":26,"value":470},{"type":20,"tag":296,"props":863,"children":864},{"style":309},[865],{"type":26,"value":866},".indices)\n",{"type":20,"tag":29,"props":868,"children":869},{},[],{"type":20,"tag":40,"props":871,"children":872},{},[873,875,880,882,888],{"type":26,"value":874},"Now we need to define the length of the data, which is not the number of entries as you might think, it's actually the number of batches, this needs to be accessible by the ",{"type":20,"tag":76,"props":876,"children":878},{"className":877},[],[879],{"type":26,"value":818},{"type":26,"value":881}," function in python so we need to define the ",{"type":20,"tag":76,"props":883,"children":885},{"className":884},[],[886],{"type":26,"value":887},"__len__",{"type":26,"value":889}," method.",{"type":20,"tag":286,"props":891,"children":893},{"className":288,"code":892,"language":290,"meta":7,"style":7},"def __len__(self):\n  return int(len(self.df) / self.batch_size)\n\n\n",[894],{"type":20,"tag":76,"props":895,"children":896},{"__ignoreMap":7},[897,921],{"type":20,"tag":296,"props":898,"children":899},{"class":298,"line":299},[900,904,909,913,917],{"type":20,"tag":296,"props":901,"children":902},{"style":414},[903],{"type":26,"value":773},{"type":20,"tag":296,"props":905,"children":906},{"style":457},[907],{"type":26,"value":908}," __len__",{"type":20,"tag":296,"props":910,"children":911},{"style":309},[912],{"type":26,"value":428},{"type":20,"tag":296,"props":914,"children":915},{"style":467},[916],{"type":26,"value":470},{"type":20,"tag":296,"props":918,"children":919},{"style":309},[920],{"type":26,"value":437},{"type":20,"tag":296,"props":922,"children":923},{"class":298,"line":325},[924,929,935,939,943,947,951,956,961,965],{"type":20,"tag":296,"props":925,"children":926},{"style":303},[927],{"type":26,"value":928},"  return",{"type":20,"tag":296,"props":930,"children":932},{"style":931},"--shiki-default:#4EC9B0;--shiki-dark:#79B8FF",[933],{"type":26,"value":934}," int",{"type":20,"tag":296,"props":936,"children":937},{"style":309},[938],{"type":26,"value":428},{"type":20,"tag":296,"props":940,"children":941},{"style":457},[942],{"type":26,"value":818},{"type":20,"tag":296,"props":944,"children":945},{"style":309},[946],{"type":26,"value":428},{"type":20,"tag":296,"props":948,"children":949},{"style":516},[950],{"type":26,"value":470},{"type":20,"tag":296,"props":952,"children":953},{"style":309},[954],{"type":26,"value":955},".df) ",{"type":20,"tag":296,"props":957,"children":958},{"style":510},[959],{"type":26,"value":960},"/",{"type":20,"tag":296,"props":962,"children":963},{"style":516},[964],{"type":26,"value":844},{"type":20,"tag":296,"props":966,"children":967},{"style":309},[968],{"type":26,"value":969},".batch_size)\n",{"type":20,"tag":29,"props":971,"children":972},{},[],{"type":20,"tag":40,"props":974,"children":975},{},[976,978,984,986,989,991,997,999,1005,1007],{"type":26,"value":977},"Now let's get serious, the fun part is in the next method which is ",{"type":20,"tag":76,"props":979,"children":981},{"className":980},[],[982],{"type":26,"value":983},"__getitem__",{"type":26,"value":985},".",{"type":20,"tag":54,"props":987,"children":988},{},[],{"type":26,"value":990},"\nThis function gets called on indexing or slicing like ",{"type":20,"tag":76,"props":992,"children":994},{"className":993},[],[995],{"type":26,"value":996},"data_generator[0]",{"type":26,"value":998}," or ",{"type":20,"tag":76,"props":1000,"children":1002},{"className":1001},[],[1003],{"type":26,"value":1004},"data_generator[1:3]",{"type":26,"value":1006}," and the index is passed as a parameter to it. Here we call it ",{"type":20,"tag":76,"props":1008,"children":1010},{"className":1009},[],[1011],{"type":26,"value":1012},"idx",{"type":20,"tag":40,"props":1014,"children":1015},{},[1016,1018,1021],{"type":26,"value":1017},"In this function we shall load and preprocess the images.",{"type":20,"tag":54,"props":1019,"children":1020},{},[],{"type":26,"value":1022},"\nThis will only be fired when keras trys to load a batch, which will save our memory.",{"type":20,"tag":40,"props":1024,"children":1025},{},[1026,1028,1031],{"type":26,"value":1027},"You might think splitting this into multiple functions would be a good idea ... and you'd be totally right.",{"type":20,"tag":54,"props":1029,"children":1030},{},[],{"type":26,"value":1032},"\nThis function should return a preprocessed batch of data",{"type":20,"tag":286,"props":1034,"children":1036},{"className":288,"code":1035,"language":290,"meta":7,"style":7},"def __getitem__(self, idx):\n  ## Initializing Batch\n  #  that one in the shape is just for a one channel images\n  # if you want to use colored images you might want to set that to 3\n  X = np.empty((self.batch_size, *self.output_size, 1))\n  # (x, y, h, w)\n  y = np.empty((self.batch_size, 4, 1))\n\n  # get the indices of the requested batch\n  indices = self.indices[idx*self.batch_size:(idx+1)*self.batch_size]\n\n  for i, data_index in enumerate(indices):\n    img_path = os.path.join(self.base_dir,\n                self.df.iloc[data_index, 0])\n\n    img = mpimg.imread()\n\n    ## this is where you preprocess the image\n    ## make sure to resize it to be self.output_size\n\n    label = self.df.iloc[data_index, 1:].to_numpy()\n    ## if you have any preprocessing for\n    ## the labels too do it here\n\n    X[i,] = img\n    y[i] = label\n\n  return X, y\n\n\n",[1037],{"type":20,"tag":76,"props":1038,"children":1039},{"__ignoreMap":7},[1040,1072,1081,1089,1097,1147,1155,1196,1203,1211,1272,1279,1307,1333,1356,1363,1380,1387,1395,1403,1410,1439,1447,1455,1463,1481,1499,1507],{"type":20,"tag":296,"props":1041,"children":1042},{"class":298,"line":299},[1043,1047,1052,1056,1060,1064,1068],{"type":20,"tag":296,"props":1044,"children":1045},{"style":414},[1046],{"type":26,"value":773},{"type":20,"tag":296,"props":1048,"children":1049},{"style":457},[1050],{"type":26,"value":1051}," __getitem__",{"type":20,"tag":296,"props":1053,"children":1054},{"style":309},[1055],{"type":26,"value":428},{"type":20,"tag":296,"props":1057,"children":1058},{"style":467},[1059],{"type":26,"value":470},{"type":20,"tag":296,"props":1061,"children":1062},{"style":309},[1063],{"type":26,"value":475},{"type":20,"tag":296,"props":1065,"children":1066},{"style":467},[1067],{"type":26,"value":1012},{"type":20,"tag":296,"props":1069,"children":1070},{"style":309},[1071],{"type":26,"value":437},{"type":20,"tag":296,"props":1073,"children":1074},{"class":298,"line":325},[1075],{"type":20,"tag":296,"props":1076,"children":1078},{"style":1077},"--shiki-default:#6A9955;--shiki-dark:#6A737D",[1079],{"type":26,"value":1080},"  ## Initializing Batch\n",{"type":20,"tag":296,"props":1082,"children":1083},{"class":298,"line":347},[1084],{"type":20,"tag":296,"props":1085,"children":1086},{"style":1077},[1087],{"type":26,"value":1088},"  #  that one in the shape is just for a one channel images\n",{"type":20,"tag":296,"props":1090,"children":1091},{"class":298,"line":369},[1092],{"type":20,"tag":296,"props":1093,"children":1094},{"style":1077},[1095],{"type":26,"value":1096},"  # if you want to use colored images you might want to set that to 3\n",{"type":20,"tag":296,"props":1098,"children":1099},{"class":298,"line":379},[1100,1105,1109,1114,1118,1123,1128,1132,1137,1142],{"type":20,"tag":296,"props":1101,"children":1102},{"style":309},[1103],{"type":26,"value":1104},"  X ",{"type":20,"tag":296,"props":1106,"children":1107},{"style":510},[1108],{"type":26,"value":513},{"type":20,"tag":296,"props":1110,"children":1111},{"style":309},[1112],{"type":26,"value":1113}," np.empty((",{"type":20,"tag":296,"props":1115,"children":1116},{"style":516},[1117],{"type":26,"value":470},{"type":20,"tag":296,"props":1119,"children":1120},{"style":309},[1121],{"type":26,"value":1122},".batch_size, ",{"type":20,"tag":296,"props":1124,"children":1125},{"style":510},[1126],{"type":26,"value":1127},"*",{"type":20,"tag":296,"props":1129,"children":1130},{"style":516},[1131],{"type":26,"value":470},{"type":20,"tag":296,"props":1133,"children":1134},{"style":309},[1135],{"type":26,"value":1136},".output_size, ",{"type":20,"tag":296,"props":1138,"children":1139},{"style":535},[1140],{"type":26,"value":1141},"1",{"type":20,"tag":296,"props":1143,"children":1144},{"style":309},[1145],{"type":26,"value":1146},"))\n",{"type":20,"tag":296,"props":1148,"children":1149},{"class":298,"line":402},[1150],{"type":20,"tag":296,"props":1151,"children":1152},{"style":1077},[1153],{"type":26,"value":1154},"  # (x, y, h, w)\n",{"type":20,"tag":296,"props":1156,"children":1157},{"class":298,"line":410},[1158,1163,1167,1171,1175,1179,1184,1188,1192],{"type":20,"tag":296,"props":1159,"children":1160},{"style":309},[1161],{"type":26,"value":1162},"  y ",{"type":20,"tag":296,"props":1164,"children":1165},{"style":510},[1166],{"type":26,"value":513},{"type":20,"tag":296,"props":1168,"children":1169},{"style":309},[1170],{"type":26,"value":1113},{"type":20,"tag":296,"props":1172,"children":1173},{"style":516},[1174],{"type":26,"value":470},{"type":20,"tag":296,"props":1176,"children":1177},{"style":309},[1178],{"type":26,"value":1122},{"type":20,"tag":296,"props":1180,"children":1181},{"style":535},[1182],{"type":26,"value":1183},"4",{"type":20,"tag":296,"props":1185,"children":1186},{"style":309},[1187],{"type":26,"value":475},{"type":20,"tag":296,"props":1189,"children":1190},{"style":535},[1191],{"type":26,"value":1141},{"type":20,"tag":296,"props":1193,"children":1194},{"style":309},[1195],{"type":26,"value":1146},{"type":20,"tag":296,"props":1197,"children":1198},{"class":298,"line":440},[1199],{"type":20,"tag":296,"props":1200,"children":1201},{"emptyLinePlaceholder":373},[1202],{"type":26,"value":376},{"type":20,"tag":296,"props":1204,"children":1205},{"class":298,"line":448},[1206],{"type":20,"tag":296,"props":1207,"children":1208},{"style":1077},[1209],{"type":26,"value":1210},"  # get the indices of the requested batch\n",{"type":20,"tag":296,"props":1212,"children":1213},{"class":298,"line":544},[1214,1219,1223,1227,1232,1236,1240,1245,1250,1254,1259,1263,1267],{"type":20,"tag":296,"props":1215,"children":1216},{"style":309},[1217],{"type":26,"value":1218},"  indices ",{"type":20,"tag":296,"props":1220,"children":1221},{"style":510},[1222],{"type":26,"value":513},{"type":20,"tag":296,"props":1224,"children":1225},{"style":516},[1226],{"type":26,"value":844},{"type":20,"tag":296,"props":1228,"children":1229},{"style":309},[1230],{"type":26,"value":1231},".indices[idx",{"type":20,"tag":296,"props":1233,"children":1234},{"style":510},[1235],{"type":26,"value":1127},{"type":20,"tag":296,"props":1237,"children":1238},{"style":516},[1239],{"type":26,"value":470},{"type":20,"tag":296,"props":1241,"children":1242},{"style":309},[1243],{"type":26,"value":1244},".batch_size:(idx",{"type":20,"tag":296,"props":1246,"children":1247},{"style":510},[1248],{"type":26,"value":1249},"+",{"type":20,"tag":296,"props":1251,"children":1252},{"style":535},[1253],{"type":26,"value":1141},{"type":20,"tag":296,"props":1255,"children":1256},{"style":309},[1257],{"type":26,"value":1258},")",{"type":20,"tag":296,"props":1260,"children":1261},{"style":510},[1262],{"type":26,"value":1127},{"type":20,"tag":296,"props":1264,"children":1265},{"style":516},[1266],{"type":26,"value":470},{"type":20,"tag":296,"props":1268,"children":1269},{"style":309},[1270],{"type":26,"value":1271},".batch_size]\n",{"type":20,"tag":296,"props":1273,"children":1274},{"class":298,"line":554},[1275],{"type":20,"tag":296,"props":1276,"children":1277},{"emptyLinePlaceholder":373},[1278],{"type":26,"value":376},{"type":20,"tag":296,"props":1280,"children":1281},{"class":298,"line":563},[1282,1287,1292,1297,1302],{"type":20,"tag":296,"props":1283,"children":1284},{"style":303},[1285],{"type":26,"value":1286},"  for",{"type":20,"tag":296,"props":1288,"children":1289},{"style":309},[1290],{"type":26,"value":1291}," i, data_index ",{"type":20,"tag":296,"props":1293,"children":1294},{"style":303},[1295],{"type":26,"value":1296},"in",{"type":20,"tag":296,"props":1298,"children":1299},{"style":457},[1300],{"type":26,"value":1301}," enumerate",{"type":20,"tag":296,"props":1303,"children":1304},{"style":309},[1305],{"type":26,"value":1306},"(indices):\n",{"type":20,"tag":296,"props":1308,"children":1309},{"class":298,"line":572},[1310,1315,1319,1324,1328],{"type":20,"tag":296,"props":1311,"children":1312},{"style":309},[1313],{"type":26,"value":1314},"    img_path ",{"type":20,"tag":296,"props":1316,"children":1317},{"style":510},[1318],{"type":26,"value":513},{"type":20,"tag":296,"props":1320,"children":1321},{"style":309},[1322],{"type":26,"value":1323}," os.path.join(",{"type":20,"tag":296,"props":1325,"children":1326},{"style":516},[1327],{"type":26,"value":470},{"type":20,"tag":296,"props":1329,"children":1330},{"style":309},[1331],{"type":26,"value":1332},".base_dir,\n",{"type":20,"tag":296,"props":1334,"children":1335},{"class":298,"line":581},[1336,1341,1346,1351],{"type":20,"tag":296,"props":1337,"children":1338},{"style":516},[1339],{"type":26,"value":1340},"                self",{"type":20,"tag":296,"props":1342,"children":1343},{"style":309},[1344],{"type":26,"value":1345},".df.iloc[data_index, ",{"type":20,"tag":296,"props":1347,"children":1348},{"style":535},[1349],{"type":26,"value":1350},"0",{"type":20,"tag":296,"props":1352,"children":1353},{"style":309},[1354],{"type":26,"value":1355},"])\n",{"type":20,"tag":296,"props":1357,"children":1358},{"class":298,"line":590},[1359],{"type":20,"tag":296,"props":1360,"children":1361},{"emptyLinePlaceholder":373},[1362],{"type":26,"value":376},{"type":20,"tag":296,"props":1364,"children":1365},{"class":298,"line":599},[1366,1371,1375],{"type":20,"tag":296,"props":1367,"children":1368},{"style":309},[1369],{"type":26,"value":1370},"    img ",{"type":20,"tag":296,"props":1372,"children":1373},{"style":510},[1374],{"type":26,"value":513},{"type":20,"tag":296,"props":1376,"children":1377},{"style":309},[1378],{"type":26,"value":1379}," mpimg.imread()\n",{"type":20,"tag":296,"props":1381,"children":1382},{"class":298,"line":608},[1383],{"type":20,"tag":296,"props":1384,"children":1385},{"emptyLinePlaceholder":373},[1386],{"type":26,"value":376},{"type":20,"tag":296,"props":1388,"children":1389},{"class":298,"line":616},[1390],{"type":20,"tag":296,"props":1391,"children":1392},{"style":1077},[1393],{"type":26,"value":1394},"    ## this is where you preprocess the image\n",{"type":20,"tag":296,"props":1396,"children":1397},{"class":298,"line":639},[1398],{"type":20,"tag":296,"props":1399,"children":1400},{"style":1077},[1401],{"type":26,"value":1402},"    ## make sure to resize it to be self.output_size\n",{"type":20,"tag":296,"props":1404,"children":1405},{"class":298,"line":661},[1406],{"type":20,"tag":296,"props":1407,"children":1408},{"emptyLinePlaceholder":373},[1409],{"type":26,"value":376},{"type":20,"tag":296,"props":1411,"children":1412},{"class":298,"line":683},[1413,1418,1422,1426,1430,1434],{"type":20,"tag":296,"props":1414,"children":1415},{"style":309},[1416],{"type":26,"value":1417},"    label ",{"type":20,"tag":296,"props":1419,"children":1420},{"style":510},[1421],{"type":26,"value":513},{"type":20,"tag":296,"props":1423,"children":1424},{"style":516},[1425],{"type":26,"value":844},{"type":20,"tag":296,"props":1427,"children":1428},{"style":309},[1429],{"type":26,"value":1345},{"type":20,"tag":296,"props":1431,"children":1432},{"style":535},[1433],{"type":26,"value":1141},{"type":20,"tag":296,"props":1435,"children":1436},{"style":309},[1437],{"type":26,"value":1438},":].to_numpy()\n",{"type":20,"tag":296,"props":1440,"children":1441},{"class":298,"line":705},[1442],{"type":20,"tag":296,"props":1443,"children":1444},{"style":1077},[1445],{"type":26,"value":1446},"    ## if you have any preprocessing for\n",{"type":20,"tag":296,"props":1448,"children":1449},{"class":298,"line":727},[1450],{"type":20,"tag":296,"props":1451,"children":1452},{"style":1077},[1453],{"type":26,"value":1454},"    ## the labels too do it here\n",{"type":20,"tag":296,"props":1456,"children":1458},{"class":298,"line":1457},24,[1459],{"type":20,"tag":296,"props":1460,"children":1461},{"emptyLinePlaceholder":373},[1462],{"type":26,"value":376},{"type":20,"tag":296,"props":1464,"children":1466},{"class":298,"line":1465},25,[1467,1472,1476],{"type":20,"tag":296,"props":1468,"children":1469},{"style":309},[1470],{"type":26,"value":1471},"    X[i,] ",{"type":20,"tag":296,"props":1473,"children":1474},{"style":510},[1475],{"type":26,"value":513},{"type":20,"tag":296,"props":1477,"children":1478},{"style":309},[1479],{"type":26,"value":1480}," img\n",{"type":20,"tag":296,"props":1482,"children":1484},{"class":298,"line":1483},26,[1485,1490,1494],{"type":20,"tag":296,"props":1486,"children":1487},{"style":309},[1488],{"type":26,"value":1489},"    y[i] ",{"type":20,"tag":296,"props":1491,"children":1492},{"style":510},[1493],{"type":26,"value":513},{"type":20,"tag":296,"props":1495,"children":1496},{"style":309},[1497],{"type":26,"value":1498}," label\n",{"type":20,"tag":296,"props":1500,"children":1502},{"class":298,"line":1501},27,[1503],{"type":20,"tag":296,"props":1504,"children":1505},{"emptyLinePlaceholder":373},[1506],{"type":26,"value":376},{"type":20,"tag":296,"props":1508,"children":1510},{"class":298,"line":1509},28,[1511,1515],{"type":20,"tag":296,"props":1512,"children":1513},{"style":303},[1514],{"type":26,"value":928},{"type":20,"tag":296,"props":1516,"children":1517},{"style":309},[1518],{"type":26,"value":1519}," X, y\n",{"type":20,"tag":29,"props":1521,"children":1522},{},[],{"type":20,"tag":40,"props":1524,"children":1525},{},[1526,1528,1534],{"type":26,"value":1527},"Now you are ready to fit the model to this generator. You can also easily make a validation generator and validate your model against that, all you need to do is make a new instance of the ",{"type":20,"tag":76,"props":1529,"children":1531},{"className":1530},[],[1532],{"type":26,"value":1533},"DataGenerator",{"type":26,"value":1535}," class, and pass in the validation csv and base directory and you're good to go. That's why I love OOP.",{"type":20,"tag":286,"props":1537,"children":1539},{"className":288,"code":1538,"language":290,"meta":7,"style":7},"from tensorflow.keras.models import Sequential\n\nmodel = Sequential([\n  ## define the model's architecture\n])\n\ntrain_gen = DataGenerator(\"data.csv\",\n                          \"data\",\n                          (244, 244),\n                          batch_size=20,\n                          shuffle=True)\n\n## compile the model first of course\n\n# now let's train the model\nmodel.fit(train_gen, epochs=5, ...)\n#  note you could also make a validation generator and pass it here like normal datasets\n\n# back in the days you had to do this\n# model.fit_generator(train_gen, ...)\n\n\n",[1540],{"type":20,"tag":76,"props":1541,"children":1542},{"__ignoreMap":7},[1543,1564,1571,1588,1596,1603,1610,1637,1649,1675,1696,1718,1725,1733,1740,1748,1783,1791,1798,1806],{"type":20,"tag":296,"props":1544,"children":1545},{"class":298,"line":299},[1546,1550,1555,1559],{"type":20,"tag":296,"props":1547,"children":1548},{"style":303},[1549],{"type":26,"value":385},{"type":20,"tag":296,"props":1551,"children":1552},{"style":309},[1553],{"type":26,"value":1554}," tensorflow.keras.models ",{"type":20,"tag":296,"props":1556,"children":1557},{"style":303},[1558],{"type":26,"value":306},{"type":20,"tag":296,"props":1560,"children":1561},{"style":309},[1562],{"type":26,"value":1563}," Sequential\n",{"type":20,"tag":296,"props":1565,"children":1566},{"class":298,"line":325},[1567],{"type":20,"tag":296,"props":1568,"children":1569},{"emptyLinePlaceholder":373},[1570],{"type":26,"value":376},{"type":20,"tag":296,"props":1572,"children":1573},{"class":298,"line":347},[1574,1579,1583],{"type":20,"tag":296,"props":1575,"children":1576},{"style":309},[1577],{"type":26,"value":1578},"model ",{"type":20,"tag":296,"props":1580,"children":1581},{"style":510},[1582],{"type":26,"value":513},{"type":20,"tag":296,"props":1584,"children":1585},{"style":309},[1586],{"type":26,"value":1587}," Sequential([\n",{"type":20,"tag":296,"props":1589,"children":1590},{"class":298,"line":369},[1591],{"type":20,"tag":296,"props":1592,"children":1593},{"style":1077},[1594],{"type":26,"value":1595},"  ## define the model's architecture\n",{"type":20,"tag":296,"props":1597,"children":1598},{"class":298,"line":379},[1599],{"type":20,"tag":296,"props":1600,"children":1601},{"style":309},[1602],{"type":26,"value":1355},{"type":20,"tag":296,"props":1604,"children":1605},{"class":298,"line":402},[1606],{"type":20,"tag":296,"props":1607,"children":1608},{"emptyLinePlaceholder":373},[1609],{"type":26,"value":376},{"type":20,"tag":296,"props":1611,"children":1612},{"class":298,"line":410},[1613,1618,1622,1627,1632],{"type":20,"tag":296,"props":1614,"children":1615},{"style":309},[1616],{"type":26,"value":1617},"train_gen ",{"type":20,"tag":296,"props":1619,"children":1620},{"style":510},[1621],{"type":26,"value":513},{"type":20,"tag":296,"props":1623,"children":1624},{"style":309},[1625],{"type":26,"value":1626}," DataGenerator(",{"type":20,"tag":296,"props":1628,"children":1629},{"style":548},[1630],{"type":26,"value":1631},"\"data.csv\"",{"type":20,"tag":296,"props":1633,"children":1634},{"style":309},[1635],{"type":26,"value":1636},",\n",{"type":20,"tag":296,"props":1638,"children":1639},{"class":298,"line":440},[1640,1645],{"type":20,"tag":296,"props":1641,"children":1642},{"style":548},[1643],{"type":26,"value":1644},"                          \"data\"",{"type":20,"tag":296,"props":1646,"children":1647},{"style":309},[1648],{"type":26,"value":1636},{"type":20,"tag":296,"props":1650,"children":1651},{"class":298,"line":448},[1652,1657,1662,1666,1670],{"type":20,"tag":296,"props":1653,"children":1654},{"style":309},[1655],{"type":26,"value":1656},"                          (",{"type":20,"tag":296,"props":1658,"children":1659},{"style":535},[1660],{"type":26,"value":1661},"244",{"type":20,"tag":296,"props":1663,"children":1664},{"style":309},[1665],{"type":26,"value":475},{"type":20,"tag":296,"props":1667,"children":1668},{"style":535},[1669],{"type":26,"value":1661},{"type":20,"tag":296,"props":1671,"children":1672},{"style":309},[1673],{"type":26,"value":1674},"),\n",{"type":20,"tag":296,"props":1676,"children":1677},{"class":298,"line":544},[1678,1684,1688,1692],{"type":20,"tag":296,"props":1679,"children":1681},{"style":1680},"--shiki-default:#9CDCFE;--shiki-dark:#FFAB70",[1682],{"type":26,"value":1683},"                          batch_size",{"type":20,"tag":296,"props":1685,"children":1686},{"style":510},[1687],{"type":26,"value":513},{"type":20,"tag":296,"props":1689,"children":1690},{"style":535},[1691],{"type":26,"value":182},{"type":20,"tag":296,"props":1693,"children":1694},{"style":309},[1695],{"type":26,"value":1636},{"type":20,"tag":296,"props":1697,"children":1698},{"class":298,"line":554},[1699,1704,1708,1713],{"type":20,"tag":296,"props":1700,"children":1701},{"style":1680},[1702],{"type":26,"value":1703},"                          shuffle",{"type":20,"tag":296,"props":1705,"children":1706},{"style":510},[1707],{"type":26,"value":513},{"type":20,"tag":296,"props":1709,"children":1710},{"style":516},[1711],{"type":26,"value":1712},"True",{"type":20,"tag":296,"props":1714,"children":1715},{"style":309},[1716],{"type":26,"value":1717},")\n",{"type":20,"tag":296,"props":1719,"children":1720},{"class":298,"line":563},[1721],{"type":20,"tag":296,"props":1722,"children":1723},{"emptyLinePlaceholder":373},[1724],{"type":26,"value":376},{"type":20,"tag":296,"props":1726,"children":1727},{"class":298,"line":572},[1728],{"type":20,"tag":296,"props":1729,"children":1730},{"style":1077},[1731],{"type":26,"value":1732},"## compile the model first of course\n",{"type":20,"tag":296,"props":1734,"children":1735},{"class":298,"line":581},[1736],{"type":20,"tag":296,"props":1737,"children":1738},{"emptyLinePlaceholder":373},[1739],{"type":26,"value":376},{"type":20,"tag":296,"props":1741,"children":1742},{"class":298,"line":590},[1743],{"type":20,"tag":296,"props":1744,"children":1745},{"style":1077},[1746],{"type":26,"value":1747},"# now let's train the model\n",{"type":20,"tag":296,"props":1749,"children":1750},{"class":298,"line":599},[1751,1756,1761,1765,1770,1774,1779],{"type":20,"tag":296,"props":1752,"children":1753},{"style":309},[1754],{"type":26,"value":1755},"model.fit(train_gen, ",{"type":20,"tag":296,"props":1757,"children":1758},{"style":1680},[1759],{"type":26,"value":1760},"epochs",{"type":20,"tag":296,"props":1762,"children":1763},{"style":510},[1764],{"type":26,"value":513},{"type":20,"tag":296,"props":1766,"children":1767},{"style":535},[1768],{"type":26,"value":1769},"5",{"type":20,"tag":296,"props":1771,"children":1772},{"style":309},[1773],{"type":26,"value":475},{"type":20,"tag":296,"props":1775,"children":1777},{"style":1776},"--shiki-default:#D4D4D4;--shiki-dark:#79B8FF",[1778],{"type":26,"value":199},{"type":20,"tag":296,"props":1780,"children":1781},{"style":309},[1782],{"type":26,"value":1717},{"type":20,"tag":296,"props":1784,"children":1785},{"class":298,"line":608},[1786],{"type":20,"tag":296,"props":1787,"children":1788},{"style":1077},[1789],{"type":26,"value":1790},"#  note you could also make a validation generator and pass it here like normal datasets\n",{"type":20,"tag":296,"props":1792,"children":1793},{"class":298,"line":616},[1794],{"type":20,"tag":296,"props":1795,"children":1796},{"emptyLinePlaceholder":373},[1797],{"type":26,"value":376},{"type":20,"tag":296,"props":1799,"children":1800},{"class":298,"line":639},[1801],{"type":20,"tag":296,"props":1802,"children":1803},{"style":1077},[1804],{"type":26,"value":1805},"# back in the days you had to do this\n",{"type":20,"tag":296,"props":1807,"children":1808},{"class":298,"line":661},[1809],{"type":20,"tag":296,"props":1810,"children":1811},{"style":1077},[1812],{"type":26,"value":1813},"# model.fit_generator(train_gen, ...)\n",{"type":20,"tag":29,"props":1815,"children":1816},{},[],{"type":20,"tag":33,"props":1818,"children":1820},{"id":1819},"the-complete-code",[1821],{"type":26,"value":1822},"The complete code",{"type":20,"tag":286,"props":1824,"children":1826},{"className":288,"code":1825,"language":290,"meta":7,"style":7},"class DataGenerator(Sequence):\n\n  def __init__(self, csv_file, base_dir, output_size, shuffle=False, batch_size=10):\n    \"\"\"\n    Initializes a data generator object\n      :param csv_file: file in which image names and numeric labels are stored\n      :param base_dir: the directory in which all images are stored\n      :param output_size: image output size after preprocessing\n      :param shuffle: shuffle the data after each epoch\n      :param batch_size: The size of each batch returned by __getitem__\n    \"\"\"\n    self.df = pd.read_csv(csv_file)\n    self.base_dir = base_dir\n    self.output_size = output_size\n    self.shuffle = shuffle\n    self.batch_size = batch_size\n    self.on_epoch_end()\n\n  def on_epoch_end(self):\n    self.indices = np.arange(len(self.df))\n    if self.shuffle:\n      np.random.shuffle(self.indices)\n\n  def __len__(self):\n    return int(len(self.df) / self.batch_size)\n\n  def __getitem__(self, idx):\n    ## Initializing Batch\n    #  that one in the shape is just for a one channel images\n    # if you want to use colored images you might want to set that to 3\n    X = np.empty((self.batch_size, *self.output_size, 1))\n    # (x, y, h, w)\n    y = np.empty((self.batch_size, 4, 1))\n\n    # get the indices of the requested batch\n    indices = self.indices[idx*self.batch_size:(idx+1)*self.batch_size]\n\n    for i, data_index in enumerate(indices):\n      img_path = os.path.join(self.base_dir,\n                  self.df.iloc[data_index, 0])\n\n      img = mpimg.imread()\n      img = cv2.cvtColor(img, cv2.COLOR_RGB2GRAY) # to reduce it to one channel to match the shape\n      ## this is where you preprocess the image\n      ## make sure to resize it to be self.output_size\n\n      label = self.df.iloc[data_index, 1:].to_numpy()\n      ## if you have any preprocessing for\n      ## the labels too do it here\n\n      X[i,] = img\n      y[i] = label\n\n    return X, y\n\n\n## Defining and training the model\n\nmodel = Sequential([\n  ## define the model's architecture\n])\n\ntrain_gen = DataGenerator(\"data.csv\", \"data\", (244, 244), batch_size=20, shuffle=True)\n\n## compile the model first of course\n\n# now let's train the model\nmodel.fit(train_gen, epochs=5, ...)\n\n\n",[1827],{"type":20,"tag":76,"props":1828,"children":1829},{"__ignoreMap":7},[1830,1853,1860,1939,1947,1955,1963,1971,1979,1987,1995,2002,2021,2040,2059,2078,2097,2108,2115,2138,2173,2189,2205,2212,2235,2279,2286,2317,2325,2334,2343,2388,2397,2438,2446,2455,2512,2520,2545,2570,2591,2599,2616,2648,2657,2666,2674,2703,2712,2721,2729,2746,2763,2771,2783,2791,2799,2808,2816,2832,2840,2848,2856,2939,2947,2955,2963,2971],{"type":20,"tag":296,"props":1831,"children":1832},{"class":298,"line":299},[1833,1837,1841,1845,1849],{"type":20,"tag":296,"props":1834,"children":1835},{"style":414},[1836],{"type":26,"value":417},{"type":20,"tag":296,"props":1838,"children":1839},{"style":420},[1840],{"type":26,"value":423},{"type":20,"tag":296,"props":1842,"children":1843},{"style":309},[1844],{"type":26,"value":428},{"type":20,"tag":296,"props":1846,"children":1847},{"style":420},[1848],{"type":26,"value":81},{"type":20,"tag":296,"props":1850,"children":1851},{"style":309},[1852],{"type":26,"value":437},{"type":20,"tag":296,"props":1854,"children":1855},{"class":298,"line":325},[1856],{"type":20,"tag":296,"props":1857,"children":1858},{"emptyLinePlaceholder":373},[1859],{"type":26,"value":376},{"type":20,"tag":296,"props":1861,"children":1862},{"class":298,"line":347},[1863,1867,1871,1875,1879,1883,1887,1891,1895,1899,1903,1907,1911,1915,1919,1923,1927,1931,1935],{"type":20,"tag":296,"props":1864,"children":1865},{"style":414},[1866],{"type":26,"value":454},{"type":20,"tag":296,"props":1868,"children":1869},{"style":457},[1870],{"type":26,"value":460},{"type":20,"tag":296,"props":1872,"children":1873},{"style":309},[1874],{"type":26,"value":428},{"type":20,"tag":296,"props":1876,"children":1877},{"style":467},[1878],{"type":26,"value":470},{"type":20,"tag":296,"props":1880,"children":1881},{"style":309},[1882],{"type":26,"value":475},{"type":20,"tag":296,"props":1884,"children":1885},{"style":467},[1886],{"type":26,"value":480},{"type":20,"tag":296,"props":1888,"children":1889},{"style":309},[1890],{"type":26,"value":475},{"type":20,"tag":296,"props":1892,"children":1893},{"style":467},[1894],{"type":26,"value":489},{"type":20,"tag":296,"props":1896,"children":1897},{"style":309},[1898],{"type":26,"value":475},{"type":20,"tag":296,"props":1900,"children":1901},{"style":467},[1902],{"type":26,"value":498},{"type":20,"tag":296,"props":1904,"children":1905},{"style":309},[1906],{"type":26,"value":475},{"type":20,"tag":296,"props":1908,"children":1909},{"style":467},[1910],{"type":26,"value":507},{"type":20,"tag":296,"props":1912,"children":1913},{"style":510},[1914],{"type":26,"value":513},{"type":20,"tag":296,"props":1916,"children":1917},{"style":516},[1918],{"type":26,"value":519},{"type":20,"tag":296,"props":1920,"children":1921},{"style":309},[1922],{"type":26,"value":475},{"type":20,"tag":296,"props":1924,"children":1925},{"style":467},[1926],{"type":26,"value":528},{"type":20,"tag":296,"props":1928,"children":1929},{"style":510},[1930],{"type":26,"value":513},{"type":20,"tag":296,"props":1932,"children":1933},{"style":535},[1934],{"type":26,"value":177},{"type":20,"tag":296,"props":1936,"children":1937},{"style":309},[1938],{"type":26,"value":437},{"type":20,"tag":296,"props":1940,"children":1941},{"class":298,"line":369},[1942],{"type":20,"tag":296,"props":1943,"children":1944},{"style":548},[1945],{"type":26,"value":1946},"    \"\"\"\n",{"type":20,"tag":296,"props":1948,"children":1949},{"class":298,"line":379},[1950],{"type":20,"tag":296,"props":1951,"children":1952},{"style":548},[1953],{"type":26,"value":1954},"    Initializes a data generator object\n",{"type":20,"tag":296,"props":1956,"children":1957},{"class":298,"line":402},[1958],{"type":20,"tag":296,"props":1959,"children":1960},{"style":548},[1961],{"type":26,"value":1962},"      :param csv_file: file in which image names and numeric labels are stored\n",{"type":20,"tag":296,"props":1964,"children":1965},{"class":298,"line":410},[1966],{"type":20,"tag":296,"props":1967,"children":1968},{"style":548},[1969],{"type":26,"value":1970},"      :param base_dir: the directory in which all images are stored\n",{"type":20,"tag":296,"props":1972,"children":1973},{"class":298,"line":440},[1974],{"type":20,"tag":296,"props":1975,"children":1976},{"style":548},[1977],{"type":26,"value":1978},"      :param output_size: image output size after preprocessing\n",{"type":20,"tag":296,"props":1980,"children":1981},{"class":298,"line":448},[1982],{"type":20,"tag":296,"props":1983,"children":1984},{"style":548},[1985],{"type":26,"value":1986},"      :param shuffle: shuffle the data after each epoch\n",{"type":20,"tag":296,"props":1988,"children":1989},{"class":298,"line":544},[1990],{"type":20,"tag":296,"props":1991,"children":1992},{"style":548},[1993],{"type":26,"value":1994},"      :param batch_size: The size of each batch returned by __getitem__\n",{"type":20,"tag":296,"props":1996,"children":1997},{"class":298,"line":554},[1998],{"type":20,"tag":296,"props":1999,"children":2000},{"style":548},[2001],{"type":26,"value":1946},{"type":20,"tag":296,"props":2003,"children":2004},{"class":298,"line":563},[2005,2009,2013,2017],{"type":20,"tag":296,"props":2006,"children":2007},{"style":516},[2008],{"type":26,"value":622},{"type":20,"tag":296,"props":2010,"children":2011},{"style":309},[2012],{"type":26,"value":627},{"type":20,"tag":296,"props":2014,"children":2015},{"style":510},[2016],{"type":26,"value":513},{"type":20,"tag":296,"props":2018,"children":2019},{"style":309},[2020],{"type":26,"value":636},{"type":20,"tag":296,"props":2022,"children":2023},{"class":298,"line":572},[2024,2028,2032,2036],{"type":20,"tag":296,"props":2025,"children":2026},{"style":516},[2027],{"type":26,"value":622},{"type":20,"tag":296,"props":2029,"children":2030},{"style":309},[2031],{"type":26,"value":649},{"type":20,"tag":296,"props":2033,"children":2034},{"style":510},[2035],{"type":26,"value":513},{"type":20,"tag":296,"props":2037,"children":2038},{"style":309},[2039],{"type":26,"value":658},{"type":20,"tag":296,"props":2041,"children":2042},{"class":298,"line":581},[2043,2047,2051,2055],{"type":20,"tag":296,"props":2044,"children":2045},{"style":516},[2046],{"type":26,"value":622},{"type":20,"tag":296,"props":2048,"children":2049},{"style":309},[2050],{"type":26,"value":671},{"type":20,"tag":296,"props":2052,"children":2053},{"style":510},[2054],{"type":26,"value":513},{"type":20,"tag":296,"props":2056,"children":2057},{"style":309},[2058],{"type":26,"value":680},{"type":20,"tag":296,"props":2060,"children":2061},{"class":298,"line":590},[2062,2066,2070,2074],{"type":20,"tag":296,"props":2063,"children":2064},{"style":516},[2065],{"type":26,"value":622},{"type":20,"tag":296,"props":2067,"children":2068},{"style":309},[2069],{"type":26,"value":693},{"type":20,"tag":296,"props":2071,"children":2072},{"style":510},[2073],{"type":26,"value":513},{"type":20,"tag":296,"props":2075,"children":2076},{"style":309},[2077],{"type":26,"value":702},{"type":20,"tag":296,"props":2079,"children":2080},{"class":298,"line":599},[2081,2085,2089,2093],{"type":20,"tag":296,"props":2082,"children":2083},{"style":516},[2084],{"type":26,"value":622},{"type":20,"tag":296,"props":2086,"children":2087},{"style":309},[2088],{"type":26,"value":715},{"type":20,"tag":296,"props":2090,"children":2091},{"style":510},[2092],{"type":26,"value":513},{"type":20,"tag":296,"props":2094,"children":2095},{"style":309},[2096],{"type":26,"value":724},{"type":20,"tag":296,"props":2098,"children":2099},{"class":298,"line":608},[2100,2104],{"type":20,"tag":296,"props":2101,"children":2102},{"style":516},[2103],{"type":26,"value":622},{"type":20,"tag":296,"props":2105,"children":2106},{"style":309},[2107],{"type":26,"value":737},{"type":20,"tag":296,"props":2109,"children":2110},{"class":298,"line":616},[2111],{"type":20,"tag":296,"props":2112,"children":2113},{"emptyLinePlaceholder":373},[2114],{"type":26,"value":376},{"type":20,"tag":296,"props":2116,"children":2117},{"class":298,"line":639},[2118,2122,2126,2130,2134],{"type":20,"tag":296,"props":2119,"children":2120},{"style":414},[2121],{"type":26,"value":454},{"type":20,"tag":296,"props":2123,"children":2124},{"style":776},[2125],{"type":26,"value":779},{"type":20,"tag":296,"props":2127,"children":2128},{"style":309},[2129],{"type":26,"value":428},{"type":20,"tag":296,"props":2131,"children":2132},{"style":467},[2133],{"type":26,"value":470},{"type":20,"tag":296,"props":2135,"children":2136},{"style":309},[2137],{"type":26,"value":437},{"type":20,"tag":296,"props":2139,"children":2140},{"class":298,"line":661},[2141,2145,2149,2153,2157,2161,2165,2169],{"type":20,"tag":296,"props":2142,"children":2143},{"style":516},[2144],{"type":26,"value":622},{"type":20,"tag":296,"props":2146,"children":2147},{"style":309},[2148],{"type":26,"value":804},{"type":20,"tag":296,"props":2150,"children":2151},{"style":510},[2152],{"type":26,"value":513},{"type":20,"tag":296,"props":2154,"children":2155},{"style":309},[2156],{"type":26,"value":813},{"type":20,"tag":296,"props":2158,"children":2159},{"style":457},[2160],{"type":26,"value":818},{"type":20,"tag":296,"props":2162,"children":2163},{"style":309},[2164],{"type":26,"value":428},{"type":20,"tag":296,"props":2166,"children":2167},{"style":516},[2168],{"type":26,"value":470},{"type":20,"tag":296,"props":2170,"children":2171},{"style":309},[2172],{"type":26,"value":831},{"type":20,"tag":296,"props":2174,"children":2175},{"class":298,"line":683},[2176,2181,2185],{"type":20,"tag":296,"props":2177,"children":2178},{"style":303},[2179],{"type":26,"value":2180},"    if",{"type":20,"tag":296,"props":2182,"children":2183},{"style":516},[2184],{"type":26,"value":844},{"type":20,"tag":296,"props":2186,"children":2187},{"style":309},[2188],{"type":26,"value":849},{"type":20,"tag":296,"props":2190,"children":2191},{"class":298,"line":705},[2192,2197,2201],{"type":20,"tag":296,"props":2193,"children":2194},{"style":309},[2195],{"type":26,"value":2196},"      np.random.shuffle(",{"type":20,"tag":296,"props":2198,"children":2199},{"style":516},[2200],{"type":26,"value":470},{"type":20,"tag":296,"props":2202,"children":2203},{"style":309},[2204],{"type":26,"value":866},{"type":20,"tag":296,"props":2206,"children":2207},{"class":298,"line":727},[2208],{"type":20,"tag":296,"props":2209,"children":2210},{"emptyLinePlaceholder":373},[2211],{"type":26,"value":376},{"type":20,"tag":296,"props":2213,"children":2214},{"class":298,"line":1457},[2215,2219,2223,2227,2231],{"type":20,"tag":296,"props":2216,"children":2217},{"style":414},[2218],{"type":26,"value":454},{"type":20,"tag":296,"props":2220,"children":2221},{"style":457},[2222],{"type":26,"value":908},{"type":20,"tag":296,"props":2224,"children":2225},{"style":309},[2226],{"type":26,"value":428},{"type":20,"tag":296,"props":2228,"children":2229},{"style":467},[2230],{"type":26,"value":470},{"type":20,"tag":296,"props":2232,"children":2233},{"style":309},[2234],{"type":26,"value":437},{"type":20,"tag":296,"props":2236,"children":2237},{"class":298,"line":1465},[2238,2243,2247,2251,2255,2259,2263,2267,2271,2275],{"type":20,"tag":296,"props":2239,"children":2240},{"style":303},[2241],{"type":26,"value":2242},"    return",{"type":20,"tag":296,"props":2244,"children":2245},{"style":931},[2246],{"type":26,"value":934},{"type":20,"tag":296,"props":2248,"children":2249},{"style":309},[2250],{"type":26,"value":428},{"type":20,"tag":296,"props":2252,"children":2253},{"style":457},[2254],{"type":26,"value":818},{"type":20,"tag":296,"props":2256,"children":2257},{"style":309},[2258],{"type":26,"value":428},{"type":20,"tag":296,"props":2260,"children":2261},{"style":516},[2262],{"type":26,"value":470},{"type":20,"tag":296,"props":2264,"children":2265},{"style":309},[2266],{"type":26,"value":955},{"type":20,"tag":296,"props":2268,"children":2269},{"style":510},[2270],{"type":26,"value":960},{"type":20,"tag":296,"props":2272,"children":2273},{"style":516},[2274],{"type":26,"value":844},{"type":20,"tag":296,"props":2276,"children":2277},{"style":309},[2278],{"type":26,"value":969},{"type":20,"tag":296,"props":2280,"children":2281},{"class":298,"line":1483},[2282],{"type":20,"tag":296,"props":2283,"children":2284},{"emptyLinePlaceholder":373},[2285],{"type":26,"value":376},{"type":20,"tag":296,"props":2287,"children":2288},{"class":298,"line":1501},[2289,2293,2297,2301,2305,2309,2313],{"type":20,"tag":296,"props":2290,"children":2291},{"style":414},[2292],{"type":26,"value":454},{"type":20,"tag":296,"props":2294,"children":2295},{"style":457},[2296],{"type":26,"value":1051},{"type":20,"tag":296,"props":2298,"children":2299},{"style":309},[2300],{"type":26,"value":428},{"type":20,"tag":296,"props":2302,"children":2303},{"style":467},[2304],{"type":26,"value":470},{"type":20,"tag":296,"props":2306,"children":2307},{"style":309},[2308],{"type":26,"value":475},{"type":20,"tag":296,"props":2310,"children":2311},{"style":467},[2312],{"type":26,"value":1012},{"type":20,"tag":296,"props":2314,"children":2315},{"style":309},[2316],{"type":26,"value":437},{"type":20,"tag":296,"props":2318,"children":2319},{"class":298,"line":1509},[2320],{"type":20,"tag":296,"props":2321,"children":2322},{"style":1077},[2323],{"type":26,"value":2324},"    ## Initializing Batch\n",{"type":20,"tag":296,"props":2326,"children":2328},{"class":298,"line":2327},29,[2329],{"type":20,"tag":296,"props":2330,"children":2331},{"style":1077},[2332],{"type":26,"value":2333},"    #  that one in the shape is just for a one channel images\n",{"type":20,"tag":296,"props":2335,"children":2337},{"class":298,"line":2336},30,[2338],{"type":20,"tag":296,"props":2339,"children":2340},{"style":1077},[2341],{"type":26,"value":2342},"    # if you want to use colored images you might want to set that to 3\n",{"type":20,"tag":296,"props":2344,"children":2346},{"class":298,"line":2345},31,[2347,2352,2356,2360,2364,2368,2372,2376,2380,2384],{"type":20,"tag":296,"props":2348,"children":2349},{"style":309},[2350],{"type":26,"value":2351},"    X ",{"type":20,"tag":296,"props":2353,"children":2354},{"style":510},[2355],{"type":26,"value":513},{"type":20,"tag":296,"props":2357,"children":2358},{"style":309},[2359],{"type":26,"value":1113},{"type":20,"tag":296,"props":2361,"children":2362},{"style":516},[2363],{"type":26,"value":470},{"type":20,"tag":296,"props":2365,"children":2366},{"style":309},[2367],{"type":26,"value":1122},{"type":20,"tag":296,"props":2369,"children":2370},{"style":510},[2371],{"type":26,"value":1127},{"type":20,"tag":296,"props":2373,"children":2374},{"style":516},[2375],{"type":26,"value":470},{"type":20,"tag":296,"props":2377,"children":2378},{"style":309},[2379],{"type":26,"value":1136},{"type":20,"tag":296,"props":2381,"children":2382},{"style":535},[2383],{"type":26,"value":1141},{"type":20,"tag":296,"props":2385,"children":2386},{"style":309},[2387],{"type":26,"value":1146},{"type":20,"tag":296,"props":2389,"children":2391},{"class":298,"line":2390},32,[2392],{"type":20,"tag":296,"props":2393,"children":2394},{"style":1077},[2395],{"type":26,"value":2396},"    # (x, y, h, w)\n",{"type":20,"tag":296,"props":2398,"children":2400},{"class":298,"line":2399},33,[2401,2406,2410,2414,2418,2422,2426,2430,2434],{"type":20,"tag":296,"props":2402,"children":2403},{"style":309},[2404],{"type":26,"value":2405},"    y ",{"type":20,"tag":296,"props":2407,"children":2408},{"style":510},[2409],{"type":26,"value":513},{"type":20,"tag":296,"props":2411,"children":2412},{"style":309},[2413],{"type":26,"value":1113},{"type":20,"tag":296,"props":2415,"children":2416},{"style":516},[2417],{"type":26,"value":470},{"type":20,"tag":296,"props":2419,"children":2420},{"style":309},[2421],{"type":26,"value":1122},{"type":20,"tag":296,"props":2423,"children":2424},{"style":535},[2425],{"type":26,"value":1183},{"type":20,"tag":296,"props":2427,"children":2428},{"style":309},[2429],{"type":26,"value":475},{"type":20,"tag":296,"props":2431,"children":2432},{"style":535},[2433],{"type":26,"value":1141},{"type":20,"tag":296,"props":2435,"children":2436},{"style":309},[2437],{"type":26,"value":1146},{"type":20,"tag":296,"props":2439,"children":2441},{"class":298,"line":2440},34,[2442],{"type":20,"tag":296,"props":2443,"children":2444},{"emptyLinePlaceholder":373},[2445],{"type":26,"value":376},{"type":20,"tag":296,"props":2447,"children":2449},{"class":298,"line":2448},35,[2450],{"type":20,"tag":296,"props":2451,"children":2452},{"style":1077},[2453],{"type":26,"value":2454},"    # get the indices of the requested batch\n",{"type":20,"tag":296,"props":2456,"children":2458},{"class":298,"line":2457},36,[2459,2464,2468,2472,2476,2480,2484,2488,2492,2496,2500,2504,2508],{"type":20,"tag":296,"props":2460,"children":2461},{"style":309},[2462],{"type":26,"value":2463},"    indices ",{"type":20,"tag":296,"props":2465,"children":2466},{"style":510},[2467],{"type":26,"value":513},{"type":20,"tag":296,"props":2469,"children":2470},{"style":516},[2471],{"type":26,"value":844},{"type":20,"tag":296,"props":2473,"children":2474},{"style":309},[2475],{"type":26,"value":1231},{"type":20,"tag":296,"props":2477,"children":2478},{"style":510},[2479],{"type":26,"value":1127},{"type":20,"tag":296,"props":2481,"children":2482},{"style":516},[2483],{"type":26,"value":470},{"type":20,"tag":296,"props":2485,"children":2486},{"style":309},[2487],{"type":26,"value":1244},{"type":20,"tag":296,"props":2489,"children":2490},{"style":510},[2491],{"type":26,"value":1249},{"type":20,"tag":296,"props":2493,"children":2494},{"style":535},[2495],{"type":26,"value":1141},{"type":20,"tag":296,"props":2497,"children":2498},{"style":309},[2499],{"type":26,"value":1258},{"type":20,"tag":296,"props":2501,"children":2502},{"style":510},[2503],{"type":26,"value":1127},{"type":20,"tag":296,"props":2505,"children":2506},{"style":516},[2507],{"type":26,"value":470},{"type":20,"tag":296,"props":2509,"children":2510},{"style":309},[2511],{"type":26,"value":1271},{"type":20,"tag":296,"props":2513,"children":2515},{"class":298,"line":2514},37,[2516],{"type":20,"tag":296,"props":2517,"children":2518},{"emptyLinePlaceholder":373},[2519],{"type":26,"value":376},{"type":20,"tag":296,"props":2521,"children":2523},{"class":298,"line":2522},38,[2524,2529,2533,2537,2541],{"type":20,"tag":296,"props":2525,"children":2526},{"style":303},[2527],{"type":26,"value":2528},"    for",{"type":20,"tag":296,"props":2530,"children":2531},{"style":309},[2532],{"type":26,"value":1291},{"type":20,"tag":296,"props":2534,"children":2535},{"style":303},[2536],{"type":26,"value":1296},{"type":20,"tag":296,"props":2538,"children":2539},{"style":457},[2540],{"type":26,"value":1301},{"type":20,"tag":296,"props":2542,"children":2543},{"style":309},[2544],{"type":26,"value":1306},{"type":20,"tag":296,"props":2546,"children":2548},{"class":298,"line":2547},39,[2549,2554,2558,2562,2566],{"type":20,"tag":296,"props":2550,"children":2551},{"style":309},[2552],{"type":26,"value":2553},"      img_path ",{"type":20,"tag":296,"props":2555,"children":2556},{"style":510},[2557],{"type":26,"value":513},{"type":20,"tag":296,"props":2559,"children":2560},{"style":309},[2561],{"type":26,"value":1323},{"type":20,"tag":296,"props":2563,"children":2564},{"style":516},[2565],{"type":26,"value":470},{"type":20,"tag":296,"props":2567,"children":2568},{"style":309},[2569],{"type":26,"value":1332},{"type":20,"tag":296,"props":2571,"children":2573},{"class":298,"line":2572},40,[2574,2579,2583,2587],{"type":20,"tag":296,"props":2575,"children":2576},{"style":516},[2577],{"type":26,"value":2578},"                  self",{"type":20,"tag":296,"props":2580,"children":2581},{"style":309},[2582],{"type":26,"value":1345},{"type":20,"tag":296,"props":2584,"children":2585},{"style":535},[2586],{"type":26,"value":1350},{"type":20,"tag":296,"props":2588,"children":2589},{"style":309},[2590],{"type":26,"value":1355},{"type":20,"tag":296,"props":2592,"children":2594},{"class":298,"line":2593},41,[2595],{"type":20,"tag":296,"props":2596,"children":2597},{"emptyLinePlaceholder":373},[2598],{"type":26,"value":376},{"type":20,"tag":296,"props":2600,"children":2602},{"class":298,"line":2601},42,[2603,2608,2612],{"type":20,"tag":296,"props":2604,"children":2605},{"style":309},[2606],{"type":26,"value":2607},"      img ",{"type":20,"tag":296,"props":2609,"children":2610},{"style":510},[2611],{"type":26,"value":513},{"type":20,"tag":296,"props":2613,"children":2614},{"style":309},[2615],{"type":26,"value":1379},{"type":20,"tag":296,"props":2617,"children":2619},{"class":298,"line":2618},43,[2620,2624,2628,2633,2638,2643],{"type":20,"tag":296,"props":2621,"children":2622},{"style":309},[2623],{"type":26,"value":2607},{"type":20,"tag":296,"props":2625,"children":2626},{"style":510},[2627],{"type":26,"value":513},{"type":20,"tag":296,"props":2629,"children":2630},{"style":309},[2631],{"type":26,"value":2632}," cv2.cvtColor(img, cv2.",{"type":20,"tag":296,"props":2634,"children":2635},{"style":1776},[2636],{"type":26,"value":2637},"COLOR_RGB2GRAY",{"type":20,"tag":296,"props":2639,"children":2640},{"style":309},[2641],{"type":26,"value":2642},") ",{"type":20,"tag":296,"props":2644,"children":2645},{"style":1077},[2646],{"type":26,"value":2647},"# to reduce it to one channel to match the shape\n",{"type":20,"tag":296,"props":2649,"children":2651},{"class":298,"line":2650},44,[2652],{"type":20,"tag":296,"props":2653,"children":2654},{"style":1077},[2655],{"type":26,"value":2656},"      ## this is where you preprocess the image\n",{"type":20,"tag":296,"props":2658,"children":2660},{"class":298,"line":2659},45,[2661],{"type":20,"tag":296,"props":2662,"children":2663},{"style":1077},[2664],{"type":26,"value":2665},"      ## make sure to resize it to be self.output_size\n",{"type":20,"tag":296,"props":2667,"children":2669},{"class":298,"line":2668},46,[2670],{"type":20,"tag":296,"props":2671,"children":2672},{"emptyLinePlaceholder":373},[2673],{"type":26,"value":376},{"type":20,"tag":296,"props":2675,"children":2677},{"class":298,"line":2676},47,[2678,2683,2687,2691,2695,2699],{"type":20,"tag":296,"props":2679,"children":2680},{"style":309},[2681],{"type":26,"value":2682},"      label ",{"type":20,"tag":296,"props":2684,"children":2685},{"style":510},[2686],{"type":26,"value":513},{"type":20,"tag":296,"props":2688,"children":2689},{"style":516},[2690],{"type":26,"value":844},{"type":20,"tag":296,"props":2692,"children":2693},{"style":309},[2694],{"type":26,"value":1345},{"type":20,"tag":296,"props":2696,"children":2697},{"style":535},[2698],{"type":26,"value":1141},{"type":20,"tag":296,"props":2700,"children":2701},{"style":309},[2702],{"type":26,"value":1438},{"type":20,"tag":296,"props":2704,"children":2706},{"class":298,"line":2705},48,[2707],{"type":20,"tag":296,"props":2708,"children":2709},{"style":1077},[2710],{"type":26,"value":2711},"      ## if you have any preprocessing for\n",{"type":20,"tag":296,"props":2713,"children":2715},{"class":298,"line":2714},49,[2716],{"type":20,"tag":296,"props":2717,"children":2718},{"style":1077},[2719],{"type":26,"value":2720},"      ## the labels too do it here\n",{"type":20,"tag":296,"props":2722,"children":2724},{"class":298,"line":2723},50,[2725],{"type":20,"tag":296,"props":2726,"children":2727},{"emptyLinePlaceholder":373},[2728],{"type":26,"value":376},{"type":20,"tag":296,"props":2730,"children":2732},{"class":298,"line":2731},51,[2733,2738,2742],{"type":20,"tag":296,"props":2734,"children":2735},{"style":309},[2736],{"type":26,"value":2737},"      X[i,] ",{"type":20,"tag":296,"props":2739,"children":2740},{"style":510},[2741],{"type":26,"value":513},{"type":20,"tag":296,"props":2743,"children":2744},{"style":309},[2745],{"type":26,"value":1480},{"type":20,"tag":296,"props":2747,"children":2749},{"class":298,"line":2748},52,[2750,2755,2759],{"type":20,"tag":296,"props":2751,"children":2752},{"style":309},[2753],{"type":26,"value":2754},"      y[i] ",{"type":20,"tag":296,"props":2756,"children":2757},{"style":510},[2758],{"type":26,"value":513},{"type":20,"tag":296,"props":2760,"children":2761},{"style":309},[2762],{"type":26,"value":1498},{"type":20,"tag":296,"props":2764,"children":2766},{"class":298,"line":2765},53,[2767],{"type":20,"tag":296,"props":2768,"children":2769},{"emptyLinePlaceholder":373},[2770],{"type":26,"value":376},{"type":20,"tag":296,"props":2772,"children":2774},{"class":298,"line":2773},54,[2775,2779],{"type":20,"tag":296,"props":2776,"children":2777},{"style":303},[2778],{"type":26,"value":2242},{"type":20,"tag":296,"props":2780,"children":2781},{"style":309},[2782],{"type":26,"value":1519},{"type":20,"tag":296,"props":2784,"children":2786},{"class":298,"line":2785},55,[2787],{"type":20,"tag":296,"props":2788,"children":2789},{"emptyLinePlaceholder":373},[2790],{"type":26,"value":376},{"type":20,"tag":296,"props":2792,"children":2794},{"class":298,"line":2793},56,[2795],{"type":20,"tag":296,"props":2796,"children":2797},{"emptyLinePlaceholder":373},[2798],{"type":26,"value":376},{"type":20,"tag":296,"props":2800,"children":2802},{"class":298,"line":2801},57,[2803],{"type":20,"tag":296,"props":2804,"children":2805},{"style":1077},[2806],{"type":26,"value":2807},"## Defining and training the model\n",{"type":20,"tag":296,"props":2809,"children":2811},{"class":298,"line":2810},58,[2812],{"type":20,"tag":296,"props":2813,"children":2814},{"emptyLinePlaceholder":373},[2815],{"type":26,"value":376},{"type":20,"tag":296,"props":2817,"children":2819},{"class":298,"line":2818},59,[2820,2824,2828],{"type":20,"tag":296,"props":2821,"children":2822},{"style":309},[2823],{"type":26,"value":1578},{"type":20,"tag":296,"props":2825,"children":2826},{"style":510},[2827],{"type":26,"value":513},{"type":20,"tag":296,"props":2829,"children":2830},{"style":309},[2831],{"type":26,"value":1587},{"type":20,"tag":296,"props":2833,"children":2835},{"class":298,"line":2834},60,[2836],{"type":20,"tag":296,"props":2837,"children":2838},{"style":1077},[2839],{"type":26,"value":1595},{"type":20,"tag":296,"props":2841,"children":2843},{"class":298,"line":2842},61,[2844],{"type":20,"tag":296,"props":2845,"children":2846},{"style":309},[2847],{"type":26,"value":1355},{"type":20,"tag":296,"props":2849,"children":2851},{"class":298,"line":2850},62,[2852],{"type":20,"tag":296,"props":2853,"children":2854},{"emptyLinePlaceholder":373},[2855],{"type":26,"value":376},{"type":20,"tag":296,"props":2857,"children":2859},{"class":298,"line":2858},63,[2860,2864,2868,2872,2876,2880,2885,2890,2894,2898,2902,2907,2911,2915,2919,2923,2927,2931,2935],{"type":20,"tag":296,"props":2861,"children":2862},{"style":309},[2863],{"type":26,"value":1617},{"type":20,"tag":296,"props":2865,"children":2866},{"style":510},[2867],{"type":26,"value":513},{"type":20,"tag":296,"props":2869,"children":2870},{"style":309},[2871],{"type":26,"value":1626},{"type":20,"tag":296,"props":2873,"children":2874},{"style":548},[2875],{"type":26,"value":1631},{"type":20,"tag":296,"props":2877,"children":2878},{"style":309},[2879],{"type":26,"value":475},{"type":20,"tag":296,"props":2881,"children":2882},{"style":548},[2883],{"type":26,"value":2884},"\"data\"",{"type":20,"tag":296,"props":2886,"children":2887},{"style":309},[2888],{"type":26,"value":2889},", (",{"type":20,"tag":296,"props":2891,"children":2892},{"style":535},[2893],{"type":26,"value":1661},{"type":20,"tag":296,"props":2895,"children":2896},{"style":309},[2897],{"type":26,"value":475},{"type":20,"tag":296,"props":2899,"children":2900},{"style":535},[2901],{"type":26,"value":1661},{"type":20,"tag":296,"props":2903,"children":2904},{"style":309},[2905],{"type":26,"value":2906},"), ",{"type":20,"tag":296,"props":2908,"children":2909},{"style":1680},[2910],{"type":26,"value":528},{"type":20,"tag":296,"props":2912,"children":2913},{"style":510},[2914],{"type":26,"value":513},{"type":20,"tag":296,"props":2916,"children":2917},{"style":535},[2918],{"type":26,"value":182},{"type":20,"tag":296,"props":2920,"children":2921},{"style":309},[2922],{"type":26,"value":475},{"type":20,"tag":296,"props":2924,"children":2925},{"style":1680},[2926],{"type":26,"value":507},{"type":20,"tag":296,"props":2928,"children":2929},{"style":510},[2930],{"type":26,"value":513},{"type":20,"tag":296,"props":2932,"children":2933},{"style":516},[2934],{"type":26,"value":1712},{"type":20,"tag":296,"props":2936,"children":2937},{"style":309},[2938],{"type":26,"value":1717},{"type":20,"tag":296,"props":2940,"children":2942},{"class":298,"line":2941},64,[2943],{"type":20,"tag":296,"props":2944,"children":2945},{"emptyLinePlaceholder":373},[2946],{"type":26,"value":376},{"type":20,"tag":296,"props":2948,"children":2950},{"class":298,"line":2949},65,[2951],{"type":20,"tag":296,"props":2952,"children":2953},{"style":1077},[2954],{"type":26,"value":1732},{"type":20,"tag":296,"props":2956,"children":2958},{"class":298,"line":2957},66,[2959],{"type":20,"tag":296,"props":2960,"children":2961},{"emptyLinePlaceholder":373},[2962],{"type":26,"value":376},{"type":20,"tag":296,"props":2964,"children":2966},{"class":298,"line":2965},67,[2967],{"type":20,"tag":296,"props":2968,"children":2969},{"style":1077},[2970],{"type":26,"value":1747},{"type":20,"tag":296,"props":2972,"children":2974},{"class":298,"line":2973},68,[2975,2979,2983,2987,2991,2995,2999],{"type":20,"tag":296,"props":2976,"children":2977},{"style":309},[2978],{"type":26,"value":1755},{"type":20,"tag":296,"props":2980,"children":2981},{"style":1680},[2982],{"type":26,"value":1760},{"type":20,"tag":296,"props":2984,"children":2985},{"style":510},[2986],{"type":26,"value":513},{"type":20,"tag":296,"props":2988,"children":2989},{"style":535},[2990],{"type":26,"value":1769},{"type":20,"tag":296,"props":2992,"children":2993},{"style":309},[2994],{"type":26,"value":475},{"type":20,"tag":296,"props":2996,"children":2997},{"style":1776},[2998],{"type":26,"value":199},{"type":20,"tag":296,"props":3000,"children":3001},{"style":309},[3002],{"type":26,"value":1717},{"type":20,"tag":29,"props":3004,"children":3005},{},[],{"type":20,"tag":40,"props":3007,"children":3008},{},[3009,3011,3014],{"type":26,"value":3010},"And that's it.. you've just created your dataset generator that loads the data into memory batch by batch instead of the whole thing at once.",{"type":20,"tag":54,"props":3012,"children":3013},{},[],{"type":26,"value":3015},"\nI hope this was useful.",{"type":20,"tag":29,"props":3017,"children":3018},{},[],{"type":20,"tag":40,"props":3020,"children":3021},{},[3022],{"type":20,"tag":85,"props":3023,"children":3026},{"className":3024,"href":3025},[88],"https://stanford.edu/~shervine/blog/keras-how-to-generate-data-on-the-fly",[3027],{"type":26,"value":3028},"Reference Article",{"type":20,"tag":40,"props":3030,"children":3031},{},[3032],{"type":20,"tag":85,"props":3033,"children":3036},{"className":3034,"href":3035},[88],"https://github.com/mahmoudyusof/facial_keypoint_detection",[3037],{"type":26,"value":3038},"My Notebooks",{"type":20,"tag":3040,"props":3041,"children":3042},"style",{},[3043],{"type":26,"value":3044},"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":7,"searchDepth":325,"depth":325,"links":3046},[3047,3048,3049,3050,3051,3052],{"id":35,"depth":325,"text":38},{"id":61,"depth":325,"text":64},{"id":100,"depth":325,"text":103},{"id":116,"depth":325,"text":119},{"id":76,"depth":325,"text":246},{"id":1819,"depth":325,"text":1822},"markdown","content:blog:1.datagenerator.md","content","blog/1.datagenerator.md","md",1718313027503]
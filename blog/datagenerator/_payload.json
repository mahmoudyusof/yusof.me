[{"data":1,"prerenderedAt":3054},["ShallowReactive",2],{"my-page":3},{"_path":4,"_dir":5,"_draft":6,"_partial":6,"_locale":7,"title":8,"description":9,"type":10,"date":11,"body":12,"_type":3049,"_id":3050,"_source":3051,"_file":3052,"_extension":3053},"/blog/datagenerator","blog",false,"","Data Generators In Tensorflow","explaining how to load batches of data into memory instead of the entire dataset for more effeciency","article","2020-05-25",{"type":13,"children":14,"toc":3041},"root",[15,24,28,35,55,61,66,94,100,110,116,118,235,238,243,248,263,268,281,734,737,750,755,863,866,886,966,969,1009,1019,1029,1516,1519,1532,1810,1813,1819,2999,3002,3012,3015,3025,3035],{"type":16,"tag":17,"props":18,"children":20},"element","h1",{"id":19},"how-to-use-data-generators-in-tensorflow",[21],{"type":22,"value":23},"text","How to use data generators in tensorflow",{"type":16,"tag":25,"props":26,"children":27},"hr",{},[],{"type":16,"tag":29,"props":30,"children":32},"h2",{"id":31},"why",[33],{"type":22,"value":34},"Why ?",{"type":16,"tag":36,"props":37,"children":38},"p",{},[39,41,47,49,53],{"type":22,"value":40},"Believe it or not, but loading the entire dataset in memory is ",{"type":16,"tag":42,"props":43,"children":44},"strong",{},[45],{"type":22,"value":46},"NOT",{"type":22,"value":48}," the best idea.",{"type":16,"tag":50,"props":51,"children":52},"br",{},[],{"type":22,"value":54},"\nIf you're dealing with a small dataset, that might work, but that is just a waste of resources, and worse if you're working on a huge dataset like the imageNet dataset, this won't work at all.",{"type":16,"tag":29,"props":56,"children":58},{"id":57},"how",[59],{"type":22,"value":60},"HOW ?",{"type":16,"tag":36,"props":62,"children":63},{},[64],{"type":22,"value":65},"Python generators are lazy which means they are iterables that give you the data upon request, unlike regular lists that just store the data in memory all the time.",{"type":16,"tag":36,"props":67,"children":68},{},[69,71,78,80,89,92],{"type":22,"value":70},"tensorflow keras has a ",{"type":16,"tag":72,"props":73,"children":75},"code",{"className":74},[],[76],{"type":22,"value":77},"Sequence",{"type":22,"value":79}," class that can be used for this purpose. ",{"type":16,"tag":81,"props":82,"children":86},"a",{"className":83,"href":85},[84],"mdlink","https://www.tensorflow.org/api_docs/python/tf/keras/utils/Sequence",[87],{"type":22,"value":88},"Sequence Class API Reference",{"type":16,"tag":50,"props":90,"children":91},{},[],{"type":22,"value":93},"\nlet's jump into it",{"type":16,"tag":29,"props":95,"children":97},{"id":96},"scenario",[98],{"type":22,"value":99},"Scenario",{"type":16,"tag":36,"props":101,"children":102},{},[103,105,108],{"type":22,"value":104},"Working with images is a good example for this, so let's say that you have pictures of objects that you need to localize,",{"type":16,"tag":50,"props":106,"children":107},{},[],{"type":22,"value":109},"\nSo your features are images and labels are (x, y, h, w) for coordinate and dimensions of the containing box, and the labels and image names are stored in a csv file.",{"type":16,"tag":29,"props":111,"children":113},{"id":112},"data",[114],{"type":22,"value":115},"Data",{"type":22,"value":117},"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",{"type":16,"tag":119,"props":120,"children":121},"table",{},[122,156],{"type":16,"tag":123,"props":124,"children":125},"thead",{},[126],{"type":16,"tag":127,"props":128,"children":129},"tr",{},[130,136,141,146,151],{"type":16,"tag":131,"props":132,"children":133},"th",{},[134],{"type":22,"value":135},"image_file    ",{"type":16,"tag":131,"props":137,"children":138},{},[139],{"type":22,"value":140},"x    ",{"type":16,"tag":131,"props":142,"children":143},{},[144],{"type":22,"value":145},"y    ",{"type":16,"tag":131,"props":147,"children":148},{},[149],{"type":22,"value":150},"w    ",{"type":16,"tag":131,"props":152,"children":153},{},[154],{"type":22,"value":155},"h    ",{"type":16,"tag":157,"props":158,"children":159},"tbody",{},[160,188,212],{"type":16,"tag":127,"props":161,"children":162},{},[163,169,174,179,184],{"type":16,"tag":164,"props":165,"children":166},"td",{},[167],{"type":22,"value":168},"file1.png",{"type":16,"tag":164,"props":170,"children":171},{},[172],{"type":22,"value":173},"10",{"type":16,"tag":164,"props":175,"children":176},{},[177],{"type":22,"value":178},"20",{"type":16,"tag":164,"props":180,"children":181},{},[182],{"type":22,"value":183},"50",{"type":16,"tag":164,"props":185,"children":186},{},[187],{"type":22,"value":183},{"type":16,"tag":127,"props":189,"children":190},{},[191,196,200,204,208],{"type":16,"tag":164,"props":192,"children":193},{},[194],{"type":22,"value":195},"...",{"type":16,"tag":164,"props":197,"children":198},{},[199],{"type":22,"value":195},{"type":16,"tag":164,"props":201,"children":202},{},[203],{"type":22,"value":195},{"type":16,"tag":164,"props":205,"children":206},{},[207],{"type":22,"value":195},{"type":16,"tag":164,"props":209,"children":210},{},[211],{"type":22,"value":195},{"type":16,"tag":127,"props":213,"children":214},{},[215,219,223,227,231],{"type":16,"tag":164,"props":216,"children":217},{},[218],{"type":22,"value":195},{"type":16,"tag":164,"props":220,"children":221},{},[222],{"type":22,"value":195},{"type":16,"tag":164,"props":224,"children":225},{},[226],{"type":22,"value":195},{"type":16,"tag":164,"props":228,"children":229},{},[230],{"type":22,"value":195},{"type":16,"tag":164,"props":232,"children":233},{},[234],{"type":22,"value":195},{"type":16,"tag":25,"props":236,"children":237},{},[],{"type":16,"tag":29,"props":239,"children":240},{"id":72},[241],{"type":22,"value":242},"Code",{"type":16,"tag":36,"props":244,"children":245},{},[246],{"type":22,"value":247},"Let's define an initializer, the initializer is going to take the information needed to get the data such as:",{"type":16,"tag":249,"props":250,"children":251},"ul",{},[252,258],{"type":16,"tag":253,"props":254,"children":255},"li",{},[256],{"type":22,"value":257},"The csv file",{"type":16,"tag":253,"props":259,"children":260},{},[261],{"type":22,"value":262},"The directory containing all of the images",{"type":16,"tag":36,"props":264,"children":265},{},[266],{"type":22,"value":267},"It will also take the output shape of the batch",{"type":16,"tag":249,"props":269,"children":270},{},[271,276],{"type":16,"tag":253,"props":272,"children":273},{},[274],{"type":22,"value":275},"The output size of each image",{"type":16,"tag":253,"props":277,"children":278},{},[279],{"type":22,"value":280},"The batch size",{"type":16,"tag":282,"props":283,"children":287},"pre",{"className":284,"code":285,"language":286,"meta":7,"style":7},"language-python shiki shiki-themes dark-plus github-dark","import numpy as np\nimport pandas as pd\nimport matplotlib.image as mpimg\n\nfrom tensorflow.keras.utils import Sequence\n\nclass DataGenerator(Sequence):\n\n  def __init__(self, csv_file, base_dir, output_size, shuffle=False, batch_size=10):\n  \"\"\"\n  Initializes a data generator object\n    :param csv_file: file in which image names and numeric labels are stored\n    :param base_dir: the directory in which all images are stored\n    :param output_size: image output size after preprocessing\n    :param shuffle: shuffle the data after each epoch\n    :param batch_size: The size of each batch returned by __getitem__\n  \"\"\"\n    self.df = pd.read_csv(csv_file)\n    self.base_dir = base_dir\n    self.output_size = output_size\n    self.shuffle = shuffle\n    self.batch_size = batch_size\n    self.on_epoch_end()\n\n\n","python",[288],{"type":16,"tag":72,"props":289,"children":290},{"__ignoreMap":7},[291,319,341,363,373,396,404,434,442,538,548,557,566,575,584,593,602,610,633,655,677,699,721],{"type":16,"tag":292,"props":293,"children":296},"span",{"class":294,"line":295},"line",1,[297,303,309,314],{"type":16,"tag":292,"props":298,"children":300},{"style":299},"--shiki-default:#C586C0;--shiki-dark:#F97583",[301],{"type":22,"value":302},"import",{"type":16,"tag":292,"props":304,"children":306},{"style":305},"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8",[307],{"type":22,"value":308}," numpy ",{"type":16,"tag":292,"props":310,"children":311},{"style":299},[312],{"type":22,"value":313},"as",{"type":16,"tag":292,"props":315,"children":316},{"style":305},[317],{"type":22,"value":318}," np\n",{"type":16,"tag":292,"props":320,"children":322},{"class":294,"line":321},2,[323,327,332,336],{"type":16,"tag":292,"props":324,"children":325},{"style":299},[326],{"type":22,"value":302},{"type":16,"tag":292,"props":328,"children":329},{"style":305},[330],{"type":22,"value":331}," pandas ",{"type":16,"tag":292,"props":333,"children":334},{"style":299},[335],{"type":22,"value":313},{"type":16,"tag":292,"props":337,"children":338},{"style":305},[339],{"type":22,"value":340}," pd\n",{"type":16,"tag":292,"props":342,"children":344},{"class":294,"line":343},3,[345,349,354,358],{"type":16,"tag":292,"props":346,"children":347},{"style":299},[348],{"type":22,"value":302},{"type":16,"tag":292,"props":350,"children":351},{"style":305},[352],{"type":22,"value":353}," matplotlib.image ",{"type":16,"tag":292,"props":355,"children":356},{"style":299},[357],{"type":22,"value":313},{"type":16,"tag":292,"props":359,"children":360},{"style":305},[361],{"type":22,"value":362}," mpimg\n",{"type":16,"tag":292,"props":364,"children":366},{"class":294,"line":365},4,[367],{"type":16,"tag":292,"props":368,"children":370},{"emptyLinePlaceholder":369},true,[371],{"type":22,"value":372},"\n",{"type":16,"tag":292,"props":374,"children":376},{"class":294,"line":375},5,[377,382,387,391],{"type":16,"tag":292,"props":378,"children":379},{"style":299},[380],{"type":22,"value":381},"from",{"type":16,"tag":292,"props":383,"children":384},{"style":305},[385],{"type":22,"value":386}," tensorflow.keras.utils ",{"type":16,"tag":292,"props":388,"children":389},{"style":299},[390],{"type":22,"value":302},{"type":16,"tag":292,"props":392,"children":393},{"style":305},[394],{"type":22,"value":395}," Sequence\n",{"type":16,"tag":292,"props":397,"children":399},{"class":294,"line":398},6,[400],{"type":16,"tag":292,"props":401,"children":402},{"emptyLinePlaceholder":369},[403],{"type":22,"value":372},{"type":16,"tag":292,"props":405,"children":407},{"class":294,"line":406},7,[408,414,420,425,429],{"type":16,"tag":292,"props":409,"children":411},{"style":410},"--shiki-default:#569CD6;--shiki-dark:#F97583",[412],{"type":22,"value":413},"class",{"type":16,"tag":292,"props":415,"children":417},{"style":416},"--shiki-default:#4EC9B0;--shiki-dark:#B392F0",[418],{"type":22,"value":419}," DataGenerator",{"type":16,"tag":292,"props":421,"children":422},{"style":305},[423],{"type":22,"value":424},"(",{"type":16,"tag":292,"props":426,"children":427},{"style":416},[428],{"type":22,"value":77},{"type":16,"tag":292,"props":430,"children":431},{"style":305},[432],{"type":22,"value":433},"):\n",{"type":16,"tag":292,"props":435,"children":437},{"class":294,"line":436},8,[438],{"type":16,"tag":292,"props":439,"children":440},{"emptyLinePlaceholder":369},[441],{"type":22,"value":372},{"type":16,"tag":292,"props":443,"children":445},{"class":294,"line":444},9,[446,451,457,461,467,472,477,481,486,490,495,499,504,510,516,520,525,529,534],{"type":16,"tag":292,"props":447,"children":448},{"style":410},[449],{"type":22,"value":450},"  def",{"type":16,"tag":292,"props":452,"children":454},{"style":453},"--shiki-default:#DCDCAA;--shiki-dark:#79B8FF",[455],{"type":22,"value":456}," __init__",{"type":16,"tag":292,"props":458,"children":459},{"style":305},[460],{"type":22,"value":424},{"type":16,"tag":292,"props":462,"children":464},{"style":463},"--shiki-default:#9CDCFE;--shiki-dark:#E1E4E8",[465],{"type":22,"value":466},"self",{"type":16,"tag":292,"props":468,"children":469},{"style":305},[470],{"type":22,"value":471},", ",{"type":16,"tag":292,"props":473,"children":474},{"style":463},[475],{"type":22,"value":476},"csv_file",{"type":16,"tag":292,"props":478,"children":479},{"style":305},[480],{"type":22,"value":471},{"type":16,"tag":292,"props":482,"children":483},{"style":463},[484],{"type":22,"value":485},"base_dir",{"type":16,"tag":292,"props":487,"children":488},{"style":305},[489],{"type":22,"value":471},{"type":16,"tag":292,"props":491,"children":492},{"style":463},[493],{"type":22,"value":494},"output_size",{"type":16,"tag":292,"props":496,"children":497},{"style":305},[498],{"type":22,"value":471},{"type":16,"tag":292,"props":500,"children":501},{"style":463},[502],{"type":22,"value":503},"shuffle",{"type":16,"tag":292,"props":505,"children":507},{"style":506},"--shiki-default:#D4D4D4;--shiki-dark:#F97583",[508],{"type":22,"value":509},"=",{"type":16,"tag":292,"props":511,"children":513},{"style":512},"--shiki-default:#569CD6;--shiki-dark:#79B8FF",[514],{"type":22,"value":515},"False",{"type":16,"tag":292,"props":517,"children":518},{"style":305},[519],{"type":22,"value":471},{"type":16,"tag":292,"props":521,"children":522},{"style":463},[523],{"type":22,"value":524},"batch_size",{"type":16,"tag":292,"props":526,"children":527},{"style":506},[528],{"type":22,"value":509},{"type":16,"tag":292,"props":530,"children":532},{"style":531},"--shiki-default:#B5CEA8;--shiki-dark:#79B8FF",[533],{"type":22,"value":173},{"type":16,"tag":292,"props":535,"children":536},{"style":305},[537],{"type":22,"value":433},{"type":16,"tag":292,"props":539,"children":541},{"class":294,"line":540},10,[542],{"type":16,"tag":292,"props":543,"children":545},{"style":544},"--shiki-default:#CE9178;--shiki-dark:#9ECBFF",[546],{"type":22,"value":547},"  \"\"\"\n",{"type":16,"tag":292,"props":549,"children":551},{"class":294,"line":550},11,[552],{"type":16,"tag":292,"props":553,"children":554},{"style":544},[555],{"type":22,"value":556},"  Initializes a data generator object\n",{"type":16,"tag":292,"props":558,"children":560},{"class":294,"line":559},12,[561],{"type":16,"tag":292,"props":562,"children":563},{"style":544},[564],{"type":22,"value":565},"    :param csv_file: file in which image names and numeric labels are stored\n",{"type":16,"tag":292,"props":567,"children":569},{"class":294,"line":568},13,[570],{"type":16,"tag":292,"props":571,"children":572},{"style":544},[573],{"type":22,"value":574},"    :param base_dir: the directory in which all images are stored\n",{"type":16,"tag":292,"props":576,"children":578},{"class":294,"line":577},14,[579],{"type":16,"tag":292,"props":580,"children":581},{"style":544},[582],{"type":22,"value":583},"    :param output_size: image output size after preprocessing\n",{"type":16,"tag":292,"props":585,"children":587},{"class":294,"line":586},15,[588],{"type":16,"tag":292,"props":589,"children":590},{"style":544},[591],{"type":22,"value":592},"    :param shuffle: shuffle the data after each epoch\n",{"type":16,"tag":292,"props":594,"children":596},{"class":294,"line":595},16,[597],{"type":16,"tag":292,"props":598,"children":599},{"style":544},[600],{"type":22,"value":601},"    :param batch_size: The size of each batch returned by __getitem__\n",{"type":16,"tag":292,"props":603,"children":605},{"class":294,"line":604},17,[606],{"type":16,"tag":292,"props":607,"children":608},{"style":544},[609],{"type":22,"value":547},{"type":16,"tag":292,"props":611,"children":613},{"class":294,"line":612},18,[614,619,624,628],{"type":16,"tag":292,"props":615,"children":616},{"style":512},[617],{"type":22,"value":618},"    self",{"type":16,"tag":292,"props":620,"children":621},{"style":305},[622],{"type":22,"value":623},".df ",{"type":16,"tag":292,"props":625,"children":626},{"style":506},[627],{"type":22,"value":509},{"type":16,"tag":292,"props":629,"children":630},{"style":305},[631],{"type":22,"value":632}," pd.read_csv(csv_file)\n",{"type":16,"tag":292,"props":634,"children":636},{"class":294,"line":635},19,[637,641,646,650],{"type":16,"tag":292,"props":638,"children":639},{"style":512},[640],{"type":22,"value":618},{"type":16,"tag":292,"props":642,"children":643},{"style":305},[644],{"type":22,"value":645},".base_dir ",{"type":16,"tag":292,"props":647,"children":648},{"style":506},[649],{"type":22,"value":509},{"type":16,"tag":292,"props":651,"children":652},{"style":305},[653],{"type":22,"value":654}," base_dir\n",{"type":16,"tag":292,"props":656,"children":658},{"class":294,"line":657},20,[659,663,668,672],{"type":16,"tag":292,"props":660,"children":661},{"style":512},[662],{"type":22,"value":618},{"type":16,"tag":292,"props":664,"children":665},{"style":305},[666],{"type":22,"value":667},".output_size ",{"type":16,"tag":292,"props":669,"children":670},{"style":506},[671],{"type":22,"value":509},{"type":16,"tag":292,"props":673,"children":674},{"style":305},[675],{"type":22,"value":676}," output_size\n",{"type":16,"tag":292,"props":678,"children":680},{"class":294,"line":679},21,[681,685,690,694],{"type":16,"tag":292,"props":682,"children":683},{"style":512},[684],{"type":22,"value":618},{"type":16,"tag":292,"props":686,"children":687},{"style":305},[688],{"type":22,"value":689},".shuffle ",{"type":16,"tag":292,"props":691,"children":692},{"style":506},[693],{"type":22,"value":509},{"type":16,"tag":292,"props":695,"children":696},{"style":305},[697],{"type":22,"value":698}," shuffle\n",{"type":16,"tag":292,"props":700,"children":702},{"class":294,"line":701},22,[703,707,712,716],{"type":16,"tag":292,"props":704,"children":705},{"style":512},[706],{"type":22,"value":618},{"type":16,"tag":292,"props":708,"children":709},{"style":305},[710],{"type":22,"value":711},".batch_size ",{"type":16,"tag":292,"props":713,"children":714},{"style":506},[715],{"type":22,"value":509},{"type":16,"tag":292,"props":717,"children":718},{"style":305},[719],{"type":22,"value":720}," batch_size\n",{"type":16,"tag":292,"props":722,"children":724},{"class":294,"line":723},23,[725,729],{"type":16,"tag":292,"props":726,"children":727},{"style":512},[728],{"type":22,"value":618},{"type":16,"tag":292,"props":730,"children":731},{"style":305},[732],{"type":22,"value":733},".on_epoch_end()\n",{"type":16,"tag":25,"props":735,"children":736},{},[],{"type":16,"tag":36,"props":738,"children":739},{},[740,742,748],{"type":22,"value":741},"Now let's define some special methods starting with the one called in the initializer ",{"type":16,"tag":72,"props":743,"children":745},{"className":744},[],[746],{"type":22,"value":747},"on_epoch_end()",{"type":22,"value":749}," that is called after each epoch as the name may suggest, duh!",{"type":16,"tag":36,"props":751,"children":752},{},[753],{"type":22,"value":754},"We call this method in the initializer because we need the indeces attribute to be set at the begining of the first epoch, otherwise we will get an error telling us that the class has no attribute \"indecies\"",{"type":16,"tag":282,"props":756,"children":758},{"className":284,"code":757,"language":286,"meta":7,"style":7},"def on_epoch_end(self):\n  self.indices = np.arange(len(self.df))\n  if self.shuffle:\n    np.random.shuffle(self.indices)\n\n\n",[759],{"type":16,"tag":72,"props":760,"children":761},{"__ignoreMap":7},[762,788,828,846],{"type":16,"tag":292,"props":763,"children":764},{"class":294,"line":295},[765,770,776,780,784],{"type":16,"tag":292,"props":766,"children":767},{"style":410},[768],{"type":22,"value":769},"def",{"type":16,"tag":292,"props":771,"children":773},{"style":772},"--shiki-default:#DCDCAA;--shiki-dark:#B392F0",[774],{"type":22,"value":775}," on_epoch_end",{"type":16,"tag":292,"props":777,"children":778},{"style":305},[779],{"type":22,"value":424},{"type":16,"tag":292,"props":781,"children":782},{"style":463},[783],{"type":22,"value":466},{"type":16,"tag":292,"props":785,"children":786},{"style":305},[787],{"type":22,"value":433},{"type":16,"tag":292,"props":789,"children":790},{"class":294,"line":321},[791,796,801,805,810,815,819,823],{"type":16,"tag":292,"props":792,"children":793},{"style":512},[794],{"type":22,"value":795},"  self",{"type":16,"tag":292,"props":797,"children":798},{"style":305},[799],{"type":22,"value":800},".indices ",{"type":16,"tag":292,"props":802,"children":803},{"style":506},[804],{"type":22,"value":509},{"type":16,"tag":292,"props":806,"children":807},{"style":305},[808],{"type":22,"value":809}," np.arange(",{"type":16,"tag":292,"props":811,"children":812},{"style":453},[813],{"type":22,"value":814},"len",{"type":16,"tag":292,"props":816,"children":817},{"style":305},[818],{"type":22,"value":424},{"type":16,"tag":292,"props":820,"children":821},{"style":512},[822],{"type":22,"value":466},{"type":16,"tag":292,"props":824,"children":825},{"style":305},[826],{"type":22,"value":827},".df))\n",{"type":16,"tag":292,"props":829,"children":830},{"class":294,"line":343},[831,836,841],{"type":16,"tag":292,"props":832,"children":833},{"style":299},[834],{"type":22,"value":835},"  if",{"type":16,"tag":292,"props":837,"children":838},{"style":512},[839],{"type":22,"value":840}," self",{"type":16,"tag":292,"props":842,"children":843},{"style":305},[844],{"type":22,"value":845},".shuffle:\n",{"type":16,"tag":292,"props":847,"children":848},{"class":294,"line":365},[849,854,858],{"type":16,"tag":292,"props":850,"children":851},{"style":305},[852],{"type":22,"value":853},"    np.random.shuffle(",{"type":16,"tag":292,"props":855,"children":856},{"style":512},[857],{"type":22,"value":466},{"type":16,"tag":292,"props":859,"children":860},{"style":305},[861],{"type":22,"value":862},".indices)\n",{"type":16,"tag":25,"props":864,"children":865},{},[],{"type":16,"tag":36,"props":867,"children":868},{},[869,871,876,878,884],{"type":22,"value":870},"Now we need to define the length of the data, which is not the number of entries as you might think, it's actually the number of batches, this needs to be accessible by the ",{"type":16,"tag":72,"props":872,"children":874},{"className":873},[],[875],{"type":22,"value":814},{"type":22,"value":877}," function in python so we need to define the ",{"type":16,"tag":72,"props":879,"children":881},{"className":880},[],[882],{"type":22,"value":883},"__len__",{"type":22,"value":885}," method.",{"type":16,"tag":282,"props":887,"children":889},{"className":284,"code":888,"language":286,"meta":7,"style":7},"def __len__(self):\n  return int(len(self.df) / self.batch_size)\n\n\n",[890],{"type":16,"tag":72,"props":891,"children":892},{"__ignoreMap":7},[893,917],{"type":16,"tag":292,"props":894,"children":895},{"class":294,"line":295},[896,900,905,909,913],{"type":16,"tag":292,"props":897,"children":898},{"style":410},[899],{"type":22,"value":769},{"type":16,"tag":292,"props":901,"children":902},{"style":453},[903],{"type":22,"value":904}," __len__",{"type":16,"tag":292,"props":906,"children":907},{"style":305},[908],{"type":22,"value":424},{"type":16,"tag":292,"props":910,"children":911},{"style":463},[912],{"type":22,"value":466},{"type":16,"tag":292,"props":914,"children":915},{"style":305},[916],{"type":22,"value":433},{"type":16,"tag":292,"props":918,"children":919},{"class":294,"line":321},[920,925,931,935,939,943,947,952,957,961],{"type":16,"tag":292,"props":921,"children":922},{"style":299},[923],{"type":22,"value":924},"  return",{"type":16,"tag":292,"props":926,"children":928},{"style":927},"--shiki-default:#4EC9B0;--shiki-dark:#79B8FF",[929],{"type":22,"value":930}," int",{"type":16,"tag":292,"props":932,"children":933},{"style":305},[934],{"type":22,"value":424},{"type":16,"tag":292,"props":936,"children":937},{"style":453},[938],{"type":22,"value":814},{"type":16,"tag":292,"props":940,"children":941},{"style":305},[942],{"type":22,"value":424},{"type":16,"tag":292,"props":944,"children":945},{"style":512},[946],{"type":22,"value":466},{"type":16,"tag":292,"props":948,"children":949},{"style":305},[950],{"type":22,"value":951},".df) ",{"type":16,"tag":292,"props":953,"children":954},{"style":506},[955],{"type":22,"value":956},"/",{"type":16,"tag":292,"props":958,"children":959},{"style":512},[960],{"type":22,"value":840},{"type":16,"tag":292,"props":962,"children":963},{"style":305},[964],{"type":22,"value":965},".batch_size)\n",{"type":16,"tag":25,"props":967,"children":968},{},[],{"type":16,"tag":36,"props":970,"children":971},{},[972,974,980,982,985,987,993,995,1001,1003],{"type":22,"value":973},"Now let's get serious, the fun part is in the next method which is ",{"type":16,"tag":72,"props":975,"children":977},{"className":976},[],[978],{"type":22,"value":979},"__getitem__",{"type":22,"value":981},".",{"type":16,"tag":50,"props":983,"children":984},{},[],{"type":22,"value":986},"\nThis function gets called on indexing or slicing like ",{"type":16,"tag":72,"props":988,"children":990},{"className":989},[],[991],{"type":22,"value":992},"data_generator[0]",{"type":22,"value":994}," or ",{"type":16,"tag":72,"props":996,"children":998},{"className":997},[],[999],{"type":22,"value":1000},"data_generator[1:3]",{"type":22,"value":1002}," and the index is passed as a parameter to it. Here we call it ",{"type":16,"tag":72,"props":1004,"children":1006},{"className":1005},[],[1007],{"type":22,"value":1008},"idx",{"type":16,"tag":36,"props":1010,"children":1011},{},[1012,1014,1017],{"type":22,"value":1013},"In this function we shall load and preprocess the images.",{"type":16,"tag":50,"props":1015,"children":1016},{},[],{"type":22,"value":1018},"\nThis will only be fired when keras trys to load a batch, which will save our memory.",{"type":16,"tag":36,"props":1020,"children":1021},{},[1022,1024,1027],{"type":22,"value":1023},"You might think splitting this into multiple functions would be a good idea ... and you'd be totally right.",{"type":16,"tag":50,"props":1025,"children":1026},{},[],{"type":22,"value":1028},"\nThis function should return a preprocessed batch of data",{"type":16,"tag":282,"props":1030,"children":1032},{"className":284,"code":1031,"language":286,"meta":7,"style":7},"def __getitem__(self, idx):\n  ## Initializing Batch\n  #  that one in the shape is just for a one channel images\n  # if you want to use colored images you might want to set that to 3\n  X = np.empty((self.batch_size, *self.output_size, 1))\n  # (x, y, h, w)\n  y = np.empty((self.batch_size, 4, 1))\n\n  # get the indices of the requested batch\n  indices = self.indices[idx*self.batch_size:(idx+1)*self.batch_size]\n\n  for i, data_index in enumerate(indices):\n    img_path = os.path.join(self.base_dir,\n                self.df.iloc[data_index, 0])\n\n    img = mpimg.imread()\n\n    ## this is where you preprocess the image\n    ## make sure to resize it to be self.output_size\n\n    label = self.df.iloc[data_index, 1:].to_numpy()\n    ## if you have any preprocessing for\n    ## the labels too do it here\n\n    X[i,] = img\n    y[i] = label\n\n  return X, y\n\n\n",[1033],{"type":16,"tag":72,"props":1034,"children":1035},{"__ignoreMap":7},[1036,1068,1077,1085,1093,1143,1151,1192,1199,1207,1268,1275,1303,1329,1352,1359,1376,1383,1391,1399,1406,1435,1443,1451,1459,1477,1495,1503],{"type":16,"tag":292,"props":1037,"children":1038},{"class":294,"line":295},[1039,1043,1048,1052,1056,1060,1064],{"type":16,"tag":292,"props":1040,"children":1041},{"style":410},[1042],{"type":22,"value":769},{"type":16,"tag":292,"props":1044,"children":1045},{"style":453},[1046],{"type":22,"value":1047}," __getitem__",{"type":16,"tag":292,"props":1049,"children":1050},{"style":305},[1051],{"type":22,"value":424},{"type":16,"tag":292,"props":1053,"children":1054},{"style":463},[1055],{"type":22,"value":466},{"type":16,"tag":292,"props":1057,"children":1058},{"style":305},[1059],{"type":22,"value":471},{"type":16,"tag":292,"props":1061,"children":1062},{"style":463},[1063],{"type":22,"value":1008},{"type":16,"tag":292,"props":1065,"children":1066},{"style":305},[1067],{"type":22,"value":433},{"type":16,"tag":292,"props":1069,"children":1070},{"class":294,"line":321},[1071],{"type":16,"tag":292,"props":1072,"children":1074},{"style":1073},"--shiki-default:#6A9955;--shiki-dark:#6A737D",[1075],{"type":22,"value":1076},"  ## Initializing Batch\n",{"type":16,"tag":292,"props":1078,"children":1079},{"class":294,"line":343},[1080],{"type":16,"tag":292,"props":1081,"children":1082},{"style":1073},[1083],{"type":22,"value":1084},"  #  that one in the shape is just for a one channel images\n",{"type":16,"tag":292,"props":1086,"children":1087},{"class":294,"line":365},[1088],{"type":16,"tag":292,"props":1089,"children":1090},{"style":1073},[1091],{"type":22,"value":1092},"  # if you want to use colored images you might want to set that to 3\n",{"type":16,"tag":292,"props":1094,"children":1095},{"class":294,"line":375},[1096,1101,1105,1110,1114,1119,1124,1128,1133,1138],{"type":16,"tag":292,"props":1097,"children":1098},{"style":305},[1099],{"type":22,"value":1100},"  X ",{"type":16,"tag":292,"props":1102,"children":1103},{"style":506},[1104],{"type":22,"value":509},{"type":16,"tag":292,"props":1106,"children":1107},{"style":305},[1108],{"type":22,"value":1109}," np.empty((",{"type":16,"tag":292,"props":1111,"children":1112},{"style":512},[1113],{"type":22,"value":466},{"type":16,"tag":292,"props":1115,"children":1116},{"style":305},[1117],{"type":22,"value":1118},".batch_size, ",{"type":16,"tag":292,"props":1120,"children":1121},{"style":506},[1122],{"type":22,"value":1123},"*",{"type":16,"tag":292,"props":1125,"children":1126},{"style":512},[1127],{"type":22,"value":466},{"type":16,"tag":292,"props":1129,"children":1130},{"style":305},[1131],{"type":22,"value":1132},".output_size, ",{"type":16,"tag":292,"props":1134,"children":1135},{"style":531},[1136],{"type":22,"value":1137},"1",{"type":16,"tag":292,"props":1139,"children":1140},{"style":305},[1141],{"type":22,"value":1142},"))\n",{"type":16,"tag":292,"props":1144,"children":1145},{"class":294,"line":398},[1146],{"type":16,"tag":292,"props":1147,"children":1148},{"style":1073},[1149],{"type":22,"value":1150},"  # (x, y, h, w)\n",{"type":16,"tag":292,"props":1152,"children":1153},{"class":294,"line":406},[1154,1159,1163,1167,1171,1175,1180,1184,1188],{"type":16,"tag":292,"props":1155,"children":1156},{"style":305},[1157],{"type":22,"value":1158},"  y ",{"type":16,"tag":292,"props":1160,"children":1161},{"style":506},[1162],{"type":22,"value":509},{"type":16,"tag":292,"props":1164,"children":1165},{"style":305},[1166],{"type":22,"value":1109},{"type":16,"tag":292,"props":1168,"children":1169},{"style":512},[1170],{"type":22,"value":466},{"type":16,"tag":292,"props":1172,"children":1173},{"style":305},[1174],{"type":22,"value":1118},{"type":16,"tag":292,"props":1176,"children":1177},{"style":531},[1178],{"type":22,"value":1179},"4",{"type":16,"tag":292,"props":1181,"children":1182},{"style":305},[1183],{"type":22,"value":471},{"type":16,"tag":292,"props":1185,"children":1186},{"style":531},[1187],{"type":22,"value":1137},{"type":16,"tag":292,"props":1189,"children":1190},{"style":305},[1191],{"type":22,"value":1142},{"type":16,"tag":292,"props":1193,"children":1194},{"class":294,"line":436},[1195],{"type":16,"tag":292,"props":1196,"children":1197},{"emptyLinePlaceholder":369},[1198],{"type":22,"value":372},{"type":16,"tag":292,"props":1200,"children":1201},{"class":294,"line":444},[1202],{"type":16,"tag":292,"props":1203,"children":1204},{"style":1073},[1205],{"type":22,"value":1206},"  # get the indices of the requested batch\n",{"type":16,"tag":292,"props":1208,"children":1209},{"class":294,"line":540},[1210,1215,1219,1223,1228,1232,1236,1241,1246,1250,1255,1259,1263],{"type":16,"tag":292,"props":1211,"children":1212},{"style":305},[1213],{"type":22,"value":1214},"  indices ",{"type":16,"tag":292,"props":1216,"children":1217},{"style":506},[1218],{"type":22,"value":509},{"type":16,"tag":292,"props":1220,"children":1221},{"style":512},[1222],{"type":22,"value":840},{"type":16,"tag":292,"props":1224,"children":1225},{"style":305},[1226],{"type":22,"value":1227},".indices[idx",{"type":16,"tag":292,"props":1229,"children":1230},{"style":506},[1231],{"type":22,"value":1123},{"type":16,"tag":292,"props":1233,"children":1234},{"style":512},[1235],{"type":22,"value":466},{"type":16,"tag":292,"props":1237,"children":1238},{"style":305},[1239],{"type":22,"value":1240},".batch_size:(idx",{"type":16,"tag":292,"props":1242,"children":1243},{"style":506},[1244],{"type":22,"value":1245},"+",{"type":16,"tag":292,"props":1247,"children":1248},{"style":531},[1249],{"type":22,"value":1137},{"type":16,"tag":292,"props":1251,"children":1252},{"style":305},[1253],{"type":22,"value":1254},")",{"type":16,"tag":292,"props":1256,"children":1257},{"style":506},[1258],{"type":22,"value":1123},{"type":16,"tag":292,"props":1260,"children":1261},{"style":512},[1262],{"type":22,"value":466},{"type":16,"tag":292,"props":1264,"children":1265},{"style":305},[1266],{"type":22,"value":1267},".batch_size]\n",{"type":16,"tag":292,"props":1269,"children":1270},{"class":294,"line":550},[1271],{"type":16,"tag":292,"props":1272,"children":1273},{"emptyLinePlaceholder":369},[1274],{"type":22,"value":372},{"type":16,"tag":292,"props":1276,"children":1277},{"class":294,"line":559},[1278,1283,1288,1293,1298],{"type":16,"tag":292,"props":1279,"children":1280},{"style":299},[1281],{"type":22,"value":1282},"  for",{"type":16,"tag":292,"props":1284,"children":1285},{"style":305},[1286],{"type":22,"value":1287}," i, data_index ",{"type":16,"tag":292,"props":1289,"children":1290},{"style":299},[1291],{"type":22,"value":1292},"in",{"type":16,"tag":292,"props":1294,"children":1295},{"style":453},[1296],{"type":22,"value":1297}," enumerate",{"type":16,"tag":292,"props":1299,"children":1300},{"style":305},[1301],{"type":22,"value":1302},"(indices):\n",{"type":16,"tag":292,"props":1304,"children":1305},{"class":294,"line":568},[1306,1311,1315,1320,1324],{"type":16,"tag":292,"props":1307,"children":1308},{"style":305},[1309],{"type":22,"value":1310},"    img_path ",{"type":16,"tag":292,"props":1312,"children":1313},{"style":506},[1314],{"type":22,"value":509},{"type":16,"tag":292,"props":1316,"children":1317},{"style":305},[1318],{"type":22,"value":1319}," os.path.join(",{"type":16,"tag":292,"props":1321,"children":1322},{"style":512},[1323],{"type":22,"value":466},{"type":16,"tag":292,"props":1325,"children":1326},{"style":305},[1327],{"type":22,"value":1328},".base_dir,\n",{"type":16,"tag":292,"props":1330,"children":1331},{"class":294,"line":577},[1332,1337,1342,1347],{"type":16,"tag":292,"props":1333,"children":1334},{"style":512},[1335],{"type":22,"value":1336},"                self",{"type":16,"tag":292,"props":1338,"children":1339},{"style":305},[1340],{"type":22,"value":1341},".df.iloc[data_index, ",{"type":16,"tag":292,"props":1343,"children":1344},{"style":531},[1345],{"type":22,"value":1346},"0",{"type":16,"tag":292,"props":1348,"children":1349},{"style":305},[1350],{"type":22,"value":1351},"])\n",{"type":16,"tag":292,"props":1353,"children":1354},{"class":294,"line":586},[1355],{"type":16,"tag":292,"props":1356,"children":1357},{"emptyLinePlaceholder":369},[1358],{"type":22,"value":372},{"type":16,"tag":292,"props":1360,"children":1361},{"class":294,"line":595},[1362,1367,1371],{"type":16,"tag":292,"props":1363,"children":1364},{"style":305},[1365],{"type":22,"value":1366},"    img ",{"type":16,"tag":292,"props":1368,"children":1369},{"style":506},[1370],{"type":22,"value":509},{"type":16,"tag":292,"props":1372,"children":1373},{"style":305},[1374],{"type":22,"value":1375}," mpimg.imread()\n",{"type":16,"tag":292,"props":1377,"children":1378},{"class":294,"line":604},[1379],{"type":16,"tag":292,"props":1380,"children":1381},{"emptyLinePlaceholder":369},[1382],{"type":22,"value":372},{"type":16,"tag":292,"props":1384,"children":1385},{"class":294,"line":612},[1386],{"type":16,"tag":292,"props":1387,"children":1388},{"style":1073},[1389],{"type":22,"value":1390},"    ## this is where you preprocess the image\n",{"type":16,"tag":292,"props":1392,"children":1393},{"class":294,"line":635},[1394],{"type":16,"tag":292,"props":1395,"children":1396},{"style":1073},[1397],{"type":22,"value":1398},"    ## make sure to resize it to be self.output_size\n",{"type":16,"tag":292,"props":1400,"children":1401},{"class":294,"line":657},[1402],{"type":16,"tag":292,"props":1403,"children":1404},{"emptyLinePlaceholder":369},[1405],{"type":22,"value":372},{"type":16,"tag":292,"props":1407,"children":1408},{"class":294,"line":679},[1409,1414,1418,1422,1426,1430],{"type":16,"tag":292,"props":1410,"children":1411},{"style":305},[1412],{"type":22,"value":1413},"    label ",{"type":16,"tag":292,"props":1415,"children":1416},{"style":506},[1417],{"type":22,"value":509},{"type":16,"tag":292,"props":1419,"children":1420},{"style":512},[1421],{"type":22,"value":840},{"type":16,"tag":292,"props":1423,"children":1424},{"style":305},[1425],{"type":22,"value":1341},{"type":16,"tag":292,"props":1427,"children":1428},{"style":531},[1429],{"type":22,"value":1137},{"type":16,"tag":292,"props":1431,"children":1432},{"style":305},[1433],{"type":22,"value":1434},":].to_numpy()\n",{"type":16,"tag":292,"props":1436,"children":1437},{"class":294,"line":701},[1438],{"type":16,"tag":292,"props":1439,"children":1440},{"style":1073},[1441],{"type":22,"value":1442},"    ## if you have any preprocessing for\n",{"type":16,"tag":292,"props":1444,"children":1445},{"class":294,"line":723},[1446],{"type":16,"tag":292,"props":1447,"children":1448},{"style":1073},[1449],{"type":22,"value":1450},"    ## the labels too do it here\n",{"type":16,"tag":292,"props":1452,"children":1454},{"class":294,"line":1453},24,[1455],{"type":16,"tag":292,"props":1456,"children":1457},{"emptyLinePlaceholder":369},[1458],{"type":22,"value":372},{"type":16,"tag":292,"props":1460,"children":1462},{"class":294,"line":1461},25,[1463,1468,1472],{"type":16,"tag":292,"props":1464,"children":1465},{"style":305},[1466],{"type":22,"value":1467},"    X[i,] ",{"type":16,"tag":292,"props":1469,"children":1470},{"style":506},[1471],{"type":22,"value":509},{"type":16,"tag":292,"props":1473,"children":1474},{"style":305},[1475],{"type":22,"value":1476}," img\n",{"type":16,"tag":292,"props":1478,"children":1480},{"class":294,"line":1479},26,[1481,1486,1490],{"type":16,"tag":292,"props":1482,"children":1483},{"style":305},[1484],{"type":22,"value":1485},"    y[i] ",{"type":16,"tag":292,"props":1487,"children":1488},{"style":506},[1489],{"type":22,"value":509},{"type":16,"tag":292,"props":1491,"children":1492},{"style":305},[1493],{"type":22,"value":1494}," label\n",{"type":16,"tag":292,"props":1496,"children":1498},{"class":294,"line":1497},27,[1499],{"type":16,"tag":292,"props":1500,"children":1501},{"emptyLinePlaceholder":369},[1502],{"type":22,"value":372},{"type":16,"tag":292,"props":1504,"children":1506},{"class":294,"line":1505},28,[1507,1511],{"type":16,"tag":292,"props":1508,"children":1509},{"style":299},[1510],{"type":22,"value":924},{"type":16,"tag":292,"props":1512,"children":1513},{"style":305},[1514],{"type":22,"value":1515}," X, y\n",{"type":16,"tag":25,"props":1517,"children":1518},{},[],{"type":16,"tag":36,"props":1520,"children":1521},{},[1522,1524,1530],{"type":22,"value":1523},"Now you are ready to fit the model to this generator. You can also easily make a validation generator and validate your model against that, all you need to do is make a new instance of the ",{"type":16,"tag":72,"props":1525,"children":1527},{"className":1526},[],[1528],{"type":22,"value":1529},"DataGenerator",{"type":22,"value":1531}," class, and pass in the validation csv and base directory and you're good to go. That's why I love OOP.",{"type":16,"tag":282,"props":1533,"children":1535},{"className":284,"code":1534,"language":286,"meta":7,"style":7},"from tensorflow.keras.models import Sequential\n\nmodel = Sequential([\n  ## define the model's architecture\n])\n\ntrain_gen = DataGenerator(\"data.csv\",\n                          \"data\",\n                          (244, 244),\n                          batch_size=20,\n                          shuffle=True)\n\n## compile the model first of course\n\n# now let's train the model\nmodel.fit(train_gen, epochs=5, ...)\n#  note you could also make a validation generator and pass it here like normal datasets\n\n# back in the days you had to do this\n# model.fit_generator(train_gen, ...)\n\n\n",[1536],{"type":16,"tag":72,"props":1537,"children":1538},{"__ignoreMap":7},[1539,1560,1567,1584,1592,1599,1606,1633,1645,1671,1692,1714,1721,1729,1736,1744,1779,1787,1794,1802],{"type":16,"tag":292,"props":1540,"children":1541},{"class":294,"line":295},[1542,1546,1551,1555],{"type":16,"tag":292,"props":1543,"children":1544},{"style":299},[1545],{"type":22,"value":381},{"type":16,"tag":292,"props":1547,"children":1548},{"style":305},[1549],{"type":22,"value":1550}," tensorflow.keras.models ",{"type":16,"tag":292,"props":1552,"children":1553},{"style":299},[1554],{"type":22,"value":302},{"type":16,"tag":292,"props":1556,"children":1557},{"style":305},[1558],{"type":22,"value":1559}," Sequential\n",{"type":16,"tag":292,"props":1561,"children":1562},{"class":294,"line":321},[1563],{"type":16,"tag":292,"props":1564,"children":1565},{"emptyLinePlaceholder":369},[1566],{"type":22,"value":372},{"type":16,"tag":292,"props":1568,"children":1569},{"class":294,"line":343},[1570,1575,1579],{"type":16,"tag":292,"props":1571,"children":1572},{"style":305},[1573],{"type":22,"value":1574},"model ",{"type":16,"tag":292,"props":1576,"children":1577},{"style":506},[1578],{"type":22,"value":509},{"type":16,"tag":292,"props":1580,"children":1581},{"style":305},[1582],{"type":22,"value":1583}," Sequential([\n",{"type":16,"tag":292,"props":1585,"children":1586},{"class":294,"line":365},[1587],{"type":16,"tag":292,"props":1588,"children":1589},{"style":1073},[1590],{"type":22,"value":1591},"  ## define the model's architecture\n",{"type":16,"tag":292,"props":1593,"children":1594},{"class":294,"line":375},[1595],{"type":16,"tag":292,"props":1596,"children":1597},{"style":305},[1598],{"type":22,"value":1351},{"type":16,"tag":292,"props":1600,"children":1601},{"class":294,"line":398},[1602],{"type":16,"tag":292,"props":1603,"children":1604},{"emptyLinePlaceholder":369},[1605],{"type":22,"value":372},{"type":16,"tag":292,"props":1607,"children":1608},{"class":294,"line":406},[1609,1614,1618,1623,1628],{"type":16,"tag":292,"props":1610,"children":1611},{"style":305},[1612],{"type":22,"value":1613},"train_gen ",{"type":16,"tag":292,"props":1615,"children":1616},{"style":506},[1617],{"type":22,"value":509},{"type":16,"tag":292,"props":1619,"children":1620},{"style":305},[1621],{"type":22,"value":1622}," DataGenerator(",{"type":16,"tag":292,"props":1624,"children":1625},{"style":544},[1626],{"type":22,"value":1627},"\"data.csv\"",{"type":16,"tag":292,"props":1629,"children":1630},{"style":305},[1631],{"type":22,"value":1632},",\n",{"type":16,"tag":292,"props":1634,"children":1635},{"class":294,"line":436},[1636,1641],{"type":16,"tag":292,"props":1637,"children":1638},{"style":544},[1639],{"type":22,"value":1640},"                          \"data\"",{"type":16,"tag":292,"props":1642,"children":1643},{"style":305},[1644],{"type":22,"value":1632},{"type":16,"tag":292,"props":1646,"children":1647},{"class":294,"line":444},[1648,1653,1658,1662,1666],{"type":16,"tag":292,"props":1649,"children":1650},{"style":305},[1651],{"type":22,"value":1652},"                          (",{"type":16,"tag":292,"props":1654,"children":1655},{"style":531},[1656],{"type":22,"value":1657},"244",{"type":16,"tag":292,"props":1659,"children":1660},{"style":305},[1661],{"type":22,"value":471},{"type":16,"tag":292,"props":1663,"children":1664},{"style":531},[1665],{"type":22,"value":1657},{"type":16,"tag":292,"props":1667,"children":1668},{"style":305},[1669],{"type":22,"value":1670},"),\n",{"type":16,"tag":292,"props":1672,"children":1673},{"class":294,"line":540},[1674,1680,1684,1688],{"type":16,"tag":292,"props":1675,"children":1677},{"style":1676},"--shiki-default:#9CDCFE;--shiki-dark:#FFAB70",[1678],{"type":22,"value":1679},"                          batch_size",{"type":16,"tag":292,"props":1681,"children":1682},{"style":506},[1683],{"type":22,"value":509},{"type":16,"tag":292,"props":1685,"children":1686},{"style":531},[1687],{"type":22,"value":178},{"type":16,"tag":292,"props":1689,"children":1690},{"style":305},[1691],{"type":22,"value":1632},{"type":16,"tag":292,"props":1693,"children":1694},{"class":294,"line":550},[1695,1700,1704,1709],{"type":16,"tag":292,"props":1696,"children":1697},{"style":1676},[1698],{"type":22,"value":1699},"                          shuffle",{"type":16,"tag":292,"props":1701,"children":1702},{"style":506},[1703],{"type":22,"value":509},{"type":16,"tag":292,"props":1705,"children":1706},{"style":512},[1707],{"type":22,"value":1708},"True",{"type":16,"tag":292,"props":1710,"children":1711},{"style":305},[1712],{"type":22,"value":1713},")\n",{"type":16,"tag":292,"props":1715,"children":1716},{"class":294,"line":559},[1717],{"type":16,"tag":292,"props":1718,"children":1719},{"emptyLinePlaceholder":369},[1720],{"type":22,"value":372},{"type":16,"tag":292,"props":1722,"children":1723},{"class":294,"line":568},[1724],{"type":16,"tag":292,"props":1725,"children":1726},{"style":1073},[1727],{"type":22,"value":1728},"## compile the model first of course\n",{"type":16,"tag":292,"props":1730,"children":1731},{"class":294,"line":577},[1732],{"type":16,"tag":292,"props":1733,"children":1734},{"emptyLinePlaceholder":369},[1735],{"type":22,"value":372},{"type":16,"tag":292,"props":1737,"children":1738},{"class":294,"line":586},[1739],{"type":16,"tag":292,"props":1740,"children":1741},{"style":1073},[1742],{"type":22,"value":1743},"# now let's train the model\n",{"type":16,"tag":292,"props":1745,"children":1746},{"class":294,"line":595},[1747,1752,1757,1761,1766,1770,1775],{"type":16,"tag":292,"props":1748,"children":1749},{"style":305},[1750],{"type":22,"value":1751},"model.fit(train_gen, ",{"type":16,"tag":292,"props":1753,"children":1754},{"style":1676},[1755],{"type":22,"value":1756},"epochs",{"type":16,"tag":292,"props":1758,"children":1759},{"style":506},[1760],{"type":22,"value":509},{"type":16,"tag":292,"props":1762,"children":1763},{"style":531},[1764],{"type":22,"value":1765},"5",{"type":16,"tag":292,"props":1767,"children":1768},{"style":305},[1769],{"type":22,"value":471},{"type":16,"tag":292,"props":1771,"children":1773},{"style":1772},"--shiki-default:#D4D4D4;--shiki-dark:#79B8FF",[1774],{"type":22,"value":195},{"type":16,"tag":292,"props":1776,"children":1777},{"style":305},[1778],{"type":22,"value":1713},{"type":16,"tag":292,"props":1780,"children":1781},{"class":294,"line":604},[1782],{"type":16,"tag":292,"props":1783,"children":1784},{"style":1073},[1785],{"type":22,"value":1786},"#  note you could also make a validation generator and pass it here like normal datasets\n",{"type":16,"tag":292,"props":1788,"children":1789},{"class":294,"line":612},[1790],{"type":16,"tag":292,"props":1791,"children":1792},{"emptyLinePlaceholder":369},[1793],{"type":22,"value":372},{"type":16,"tag":292,"props":1795,"children":1796},{"class":294,"line":635},[1797],{"type":16,"tag":292,"props":1798,"children":1799},{"style":1073},[1800],{"type":22,"value":1801},"# back in the days you had to do this\n",{"type":16,"tag":292,"props":1803,"children":1804},{"class":294,"line":657},[1805],{"type":16,"tag":292,"props":1806,"children":1807},{"style":1073},[1808],{"type":22,"value":1809},"# model.fit_generator(train_gen, ...)\n",{"type":16,"tag":25,"props":1811,"children":1812},{},[],{"type":16,"tag":29,"props":1814,"children":1816},{"id":1815},"the-complete-code",[1817],{"type":22,"value":1818},"The complete code",{"type":16,"tag":282,"props":1820,"children":1822},{"className":284,"code":1821,"language":286,"meta":7,"style":7},"class DataGenerator(Sequence):\n\n  def __init__(self, csv_file, base_dir, output_size, shuffle=False, batch_size=10):\n    \"\"\"\n    Initializes a data generator object\n      :param csv_file: file in which image names and numeric labels are stored\n      :param base_dir: the directory in which all images are stored\n      :param output_size: image output size after preprocessing\n      :param shuffle: shuffle the data after each epoch\n      :param batch_size: The size of each batch returned by __getitem__\n    \"\"\"\n    self.df = pd.read_csv(csv_file)\n    self.base_dir = base_dir\n    self.output_size = output_size\n    self.shuffle = shuffle\n    self.batch_size = batch_size\n    self.on_epoch_end()\n\n  def on_epoch_end(self):\n    self.indices = np.arange(len(self.df))\n    if self.shuffle:\n      np.random.shuffle(self.indices)\n\n  def __len__(self):\n    return int(len(self.df) / self.batch_size)\n\n  def __getitem__(self, idx):\n    ## Initializing Batch\n    #  that one in the shape is just for a one channel images\n    # if you want to use colored images you might want to set that to 3\n    X = np.empty((self.batch_size, *self.output_size, 1))\n    # (x, y, h, w)\n    y = np.empty((self.batch_size, 4, 1))\n\n    # get the indices of the requested batch\n    indices = self.indices[idx*self.batch_size:(idx+1)*self.batch_size]\n\n    for i, data_index in enumerate(indices):\n      img_path = os.path.join(self.base_dir,\n                  self.df.iloc[data_index, 0])\n\n      img = mpimg.imread()\n      img = cv2.cvtColor(img, cv2.COLOR_RGB2GRAY) # to reduce it to one channel to match the shape\n      ## this is where you preprocess the image\n      ## make sure to resize it to be self.output_size\n\n      label = self.df.iloc[data_index, 1:].to_numpy()\n      ## if you have any preprocessing for\n      ## the labels too do it here\n\n      X[i,] = img\n      y[i] = label\n\n    return X, y\n\n\n## Defining and training the model\n\nmodel = Sequential([\n  ## define the model's architecture\n])\n\ntrain_gen = DataGenerator(\"data.csv\", \"data\", (244, 244), batch_size=20, shuffle=True)\n\n## compile the model first of course\n\n# now let's train the model\nmodel.fit(train_gen, epochs=5, ...)\n\n\n",[1823],{"type":16,"tag":72,"props":1824,"children":1825},{"__ignoreMap":7},[1826,1849,1856,1935,1943,1951,1959,1967,1975,1983,1991,1998,2017,2036,2055,2074,2093,2104,2111,2134,2169,2185,2201,2208,2231,2275,2282,2313,2321,2330,2339,2384,2393,2434,2442,2451,2508,2516,2541,2566,2587,2595,2612,2644,2653,2662,2670,2699,2708,2717,2725,2742,2759,2767,2779,2787,2795,2804,2812,2828,2836,2844,2852,2935,2943,2951,2959,2967],{"type":16,"tag":292,"props":1827,"children":1828},{"class":294,"line":295},[1829,1833,1837,1841,1845],{"type":16,"tag":292,"props":1830,"children":1831},{"style":410},[1832],{"type":22,"value":413},{"type":16,"tag":292,"props":1834,"children":1835},{"style":416},[1836],{"type":22,"value":419},{"type":16,"tag":292,"props":1838,"children":1839},{"style":305},[1840],{"type":22,"value":424},{"type":16,"tag":292,"props":1842,"children":1843},{"style":416},[1844],{"type":22,"value":77},{"type":16,"tag":292,"props":1846,"children":1847},{"style":305},[1848],{"type":22,"value":433},{"type":16,"tag":292,"props":1850,"children":1851},{"class":294,"line":321},[1852],{"type":16,"tag":292,"props":1853,"children":1854},{"emptyLinePlaceholder":369},[1855],{"type":22,"value":372},{"type":16,"tag":292,"props":1857,"children":1858},{"class":294,"line":343},[1859,1863,1867,1871,1875,1879,1883,1887,1891,1895,1899,1903,1907,1911,1915,1919,1923,1927,1931],{"type":16,"tag":292,"props":1860,"children":1861},{"style":410},[1862],{"type":22,"value":450},{"type":16,"tag":292,"props":1864,"children":1865},{"style":453},[1866],{"type":22,"value":456},{"type":16,"tag":292,"props":1868,"children":1869},{"style":305},[1870],{"type":22,"value":424},{"type":16,"tag":292,"props":1872,"children":1873},{"style":463},[1874],{"type":22,"value":466},{"type":16,"tag":292,"props":1876,"children":1877},{"style":305},[1878],{"type":22,"value":471},{"type":16,"tag":292,"props":1880,"children":1881},{"style":463},[1882],{"type":22,"value":476},{"type":16,"tag":292,"props":1884,"children":1885},{"style":305},[1886],{"type":22,"value":471},{"type":16,"tag":292,"props":1888,"children":1889},{"style":463},[1890],{"type":22,"value":485},{"type":16,"tag":292,"props":1892,"children":1893},{"style":305},[1894],{"type":22,"value":471},{"type":16,"tag":292,"props":1896,"children":1897},{"style":463},[1898],{"type":22,"value":494},{"type":16,"tag":292,"props":1900,"children":1901},{"style":305},[1902],{"type":22,"value":471},{"type":16,"tag":292,"props":1904,"children":1905},{"style":463},[1906],{"type":22,"value":503},{"type":16,"tag":292,"props":1908,"children":1909},{"style":506},[1910],{"type":22,"value":509},{"type":16,"tag":292,"props":1912,"children":1913},{"style":512},[1914],{"type":22,"value":515},{"type":16,"tag":292,"props":1916,"children":1917},{"style":305},[1918],{"type":22,"value":471},{"type":16,"tag":292,"props":1920,"children":1921},{"style":463},[1922],{"type":22,"value":524},{"type":16,"tag":292,"props":1924,"children":1925},{"style":506},[1926],{"type":22,"value":509},{"type":16,"tag":292,"props":1928,"children":1929},{"style":531},[1930],{"type":22,"value":173},{"type":16,"tag":292,"props":1932,"children":1933},{"style":305},[1934],{"type":22,"value":433},{"type":16,"tag":292,"props":1936,"children":1937},{"class":294,"line":365},[1938],{"type":16,"tag":292,"props":1939,"children":1940},{"style":544},[1941],{"type":22,"value":1942},"    \"\"\"\n",{"type":16,"tag":292,"props":1944,"children":1945},{"class":294,"line":375},[1946],{"type":16,"tag":292,"props":1947,"children":1948},{"style":544},[1949],{"type":22,"value":1950},"    Initializes a data generator object\n",{"type":16,"tag":292,"props":1952,"children":1953},{"class":294,"line":398},[1954],{"type":16,"tag":292,"props":1955,"children":1956},{"style":544},[1957],{"type":22,"value":1958},"      :param csv_file: file in which image names and numeric labels are stored\n",{"type":16,"tag":292,"props":1960,"children":1961},{"class":294,"line":406},[1962],{"type":16,"tag":292,"props":1963,"children":1964},{"style":544},[1965],{"type":22,"value":1966},"      :param base_dir: the directory in which all images are stored\n",{"type":16,"tag":292,"props":1968,"children":1969},{"class":294,"line":436},[1970],{"type":16,"tag":292,"props":1971,"children":1972},{"style":544},[1973],{"type":22,"value":1974},"      :param output_size: image output size after preprocessing\n",{"type":16,"tag":292,"props":1976,"children":1977},{"class":294,"line":444},[1978],{"type":16,"tag":292,"props":1979,"children":1980},{"style":544},[1981],{"type":22,"value":1982},"      :param shuffle: shuffle the data after each epoch\n",{"type":16,"tag":292,"props":1984,"children":1985},{"class":294,"line":540},[1986],{"type":16,"tag":292,"props":1987,"children":1988},{"style":544},[1989],{"type":22,"value":1990},"      :param batch_size: The size of each batch returned by __getitem__\n",{"type":16,"tag":292,"props":1992,"children":1993},{"class":294,"line":550},[1994],{"type":16,"tag":292,"props":1995,"children":1996},{"style":544},[1997],{"type":22,"value":1942},{"type":16,"tag":292,"props":1999,"children":2000},{"class":294,"line":559},[2001,2005,2009,2013],{"type":16,"tag":292,"props":2002,"children":2003},{"style":512},[2004],{"type":22,"value":618},{"type":16,"tag":292,"props":2006,"children":2007},{"style":305},[2008],{"type":22,"value":623},{"type":16,"tag":292,"props":2010,"children":2011},{"style":506},[2012],{"type":22,"value":509},{"type":16,"tag":292,"props":2014,"children":2015},{"style":305},[2016],{"type":22,"value":632},{"type":16,"tag":292,"props":2018,"children":2019},{"class":294,"line":568},[2020,2024,2028,2032],{"type":16,"tag":292,"props":2021,"children":2022},{"style":512},[2023],{"type":22,"value":618},{"type":16,"tag":292,"props":2025,"children":2026},{"style":305},[2027],{"type":22,"value":645},{"type":16,"tag":292,"props":2029,"children":2030},{"style":506},[2031],{"type":22,"value":509},{"type":16,"tag":292,"props":2033,"children":2034},{"style":305},[2035],{"type":22,"value":654},{"type":16,"tag":292,"props":2037,"children":2038},{"class":294,"line":577},[2039,2043,2047,2051],{"type":16,"tag":292,"props":2040,"children":2041},{"style":512},[2042],{"type":22,"value":618},{"type":16,"tag":292,"props":2044,"children":2045},{"style":305},[2046],{"type":22,"value":667},{"type":16,"tag":292,"props":2048,"children":2049},{"style":506},[2050],{"type":22,"value":509},{"type":16,"tag":292,"props":2052,"children":2053},{"style":305},[2054],{"type":22,"value":676},{"type":16,"tag":292,"props":2056,"children":2057},{"class":294,"line":586},[2058,2062,2066,2070],{"type":16,"tag":292,"props":2059,"children":2060},{"style":512},[2061],{"type":22,"value":618},{"type":16,"tag":292,"props":2063,"children":2064},{"style":305},[2065],{"type":22,"value":689},{"type":16,"tag":292,"props":2067,"children":2068},{"style":506},[2069],{"type":22,"value":509},{"type":16,"tag":292,"props":2071,"children":2072},{"style":305},[2073],{"type":22,"value":698},{"type":16,"tag":292,"props":2075,"children":2076},{"class":294,"line":595},[2077,2081,2085,2089],{"type":16,"tag":292,"props":2078,"children":2079},{"style":512},[2080],{"type":22,"value":618},{"type":16,"tag":292,"props":2082,"children":2083},{"style":305},[2084],{"type":22,"value":711},{"type":16,"tag":292,"props":2086,"children":2087},{"style":506},[2088],{"type":22,"value":509},{"type":16,"tag":292,"props":2090,"children":2091},{"style":305},[2092],{"type":22,"value":720},{"type":16,"tag":292,"props":2094,"children":2095},{"class":294,"line":604},[2096,2100],{"type":16,"tag":292,"props":2097,"children":2098},{"style":512},[2099],{"type":22,"value":618},{"type":16,"tag":292,"props":2101,"children":2102},{"style":305},[2103],{"type":22,"value":733},{"type":16,"tag":292,"props":2105,"children":2106},{"class":294,"line":612},[2107],{"type":16,"tag":292,"props":2108,"children":2109},{"emptyLinePlaceholder":369},[2110],{"type":22,"value":372},{"type":16,"tag":292,"props":2112,"children":2113},{"class":294,"line":635},[2114,2118,2122,2126,2130],{"type":16,"tag":292,"props":2115,"children":2116},{"style":410},[2117],{"type":22,"value":450},{"type":16,"tag":292,"props":2119,"children":2120},{"style":772},[2121],{"type":22,"value":775},{"type":16,"tag":292,"props":2123,"children":2124},{"style":305},[2125],{"type":22,"value":424},{"type":16,"tag":292,"props":2127,"children":2128},{"style":463},[2129],{"type":22,"value":466},{"type":16,"tag":292,"props":2131,"children":2132},{"style":305},[2133],{"type":22,"value":433},{"type":16,"tag":292,"props":2135,"children":2136},{"class":294,"line":657},[2137,2141,2145,2149,2153,2157,2161,2165],{"type":16,"tag":292,"props":2138,"children":2139},{"style":512},[2140],{"type":22,"value":618},{"type":16,"tag":292,"props":2142,"children":2143},{"style":305},[2144],{"type":22,"value":800},{"type":16,"tag":292,"props":2146,"children":2147},{"style":506},[2148],{"type":22,"value":509},{"type":16,"tag":292,"props":2150,"children":2151},{"style":305},[2152],{"type":22,"value":809},{"type":16,"tag":292,"props":2154,"children":2155},{"style":453},[2156],{"type":22,"value":814},{"type":16,"tag":292,"props":2158,"children":2159},{"style":305},[2160],{"type":22,"value":424},{"type":16,"tag":292,"props":2162,"children":2163},{"style":512},[2164],{"type":22,"value":466},{"type":16,"tag":292,"props":2166,"children":2167},{"style":305},[2168],{"type":22,"value":827},{"type":16,"tag":292,"props":2170,"children":2171},{"class":294,"line":679},[2172,2177,2181],{"type":16,"tag":292,"props":2173,"children":2174},{"style":299},[2175],{"type":22,"value":2176},"    if",{"type":16,"tag":292,"props":2178,"children":2179},{"style":512},[2180],{"type":22,"value":840},{"type":16,"tag":292,"props":2182,"children":2183},{"style":305},[2184],{"type":22,"value":845},{"type":16,"tag":292,"props":2186,"children":2187},{"class":294,"line":701},[2188,2193,2197],{"type":16,"tag":292,"props":2189,"children":2190},{"style":305},[2191],{"type":22,"value":2192},"      np.random.shuffle(",{"type":16,"tag":292,"props":2194,"children":2195},{"style":512},[2196],{"type":22,"value":466},{"type":16,"tag":292,"props":2198,"children":2199},{"style":305},[2200],{"type":22,"value":862},{"type":16,"tag":292,"props":2202,"children":2203},{"class":294,"line":723},[2204],{"type":16,"tag":292,"props":2205,"children":2206},{"emptyLinePlaceholder":369},[2207],{"type":22,"value":372},{"type":16,"tag":292,"props":2209,"children":2210},{"class":294,"line":1453},[2211,2215,2219,2223,2227],{"type":16,"tag":292,"props":2212,"children":2213},{"style":410},[2214],{"type":22,"value":450},{"type":16,"tag":292,"props":2216,"children":2217},{"style":453},[2218],{"type":22,"value":904},{"type":16,"tag":292,"props":2220,"children":2221},{"style":305},[2222],{"type":22,"value":424},{"type":16,"tag":292,"props":2224,"children":2225},{"style":463},[2226],{"type":22,"value":466},{"type":16,"tag":292,"props":2228,"children":2229},{"style":305},[2230],{"type":22,"value":433},{"type":16,"tag":292,"props":2232,"children":2233},{"class":294,"line":1461},[2234,2239,2243,2247,2251,2255,2259,2263,2267,2271],{"type":16,"tag":292,"props":2235,"children":2236},{"style":299},[2237],{"type":22,"value":2238},"    return",{"type":16,"tag":292,"props":2240,"children":2241},{"style":927},[2242],{"type":22,"value":930},{"type":16,"tag":292,"props":2244,"children":2245},{"style":305},[2246],{"type":22,"value":424},{"type":16,"tag":292,"props":2248,"children":2249},{"style":453},[2250],{"type":22,"value":814},{"type":16,"tag":292,"props":2252,"children":2253},{"style":305},[2254],{"type":22,"value":424},{"type":16,"tag":292,"props":2256,"children":2257},{"style":512},[2258],{"type":22,"value":466},{"type":16,"tag":292,"props":2260,"children":2261},{"style":305},[2262],{"type":22,"value":951},{"type":16,"tag":292,"props":2264,"children":2265},{"style":506},[2266],{"type":22,"value":956},{"type":16,"tag":292,"props":2268,"children":2269},{"style":512},[2270],{"type":22,"value":840},{"type":16,"tag":292,"props":2272,"children":2273},{"style":305},[2274],{"type":22,"value":965},{"type":16,"tag":292,"props":2276,"children":2277},{"class":294,"line":1479},[2278],{"type":16,"tag":292,"props":2279,"children":2280},{"emptyLinePlaceholder":369},[2281],{"type":22,"value":372},{"type":16,"tag":292,"props":2283,"children":2284},{"class":294,"line":1497},[2285,2289,2293,2297,2301,2305,2309],{"type":16,"tag":292,"props":2286,"children":2287},{"style":410},[2288],{"type":22,"value":450},{"type":16,"tag":292,"props":2290,"children":2291},{"style":453},[2292],{"type":22,"value":1047},{"type":16,"tag":292,"props":2294,"children":2295},{"style":305},[2296],{"type":22,"value":424},{"type":16,"tag":292,"props":2298,"children":2299},{"style":463},[2300],{"type":22,"value":466},{"type":16,"tag":292,"props":2302,"children":2303},{"style":305},[2304],{"type":22,"value":471},{"type":16,"tag":292,"props":2306,"children":2307},{"style":463},[2308],{"type":22,"value":1008},{"type":16,"tag":292,"props":2310,"children":2311},{"style":305},[2312],{"type":22,"value":433},{"type":16,"tag":292,"props":2314,"children":2315},{"class":294,"line":1505},[2316],{"type":16,"tag":292,"props":2317,"children":2318},{"style":1073},[2319],{"type":22,"value":2320},"    ## Initializing Batch\n",{"type":16,"tag":292,"props":2322,"children":2324},{"class":294,"line":2323},29,[2325],{"type":16,"tag":292,"props":2326,"children":2327},{"style":1073},[2328],{"type":22,"value":2329},"    #  that one in the shape is just for a one channel images\n",{"type":16,"tag":292,"props":2331,"children":2333},{"class":294,"line":2332},30,[2334],{"type":16,"tag":292,"props":2335,"children":2336},{"style":1073},[2337],{"type":22,"value":2338},"    # if you want to use colored images you might want to set that to 3\n",{"type":16,"tag":292,"props":2340,"children":2342},{"class":294,"line":2341},31,[2343,2348,2352,2356,2360,2364,2368,2372,2376,2380],{"type":16,"tag":292,"props":2344,"children":2345},{"style":305},[2346],{"type":22,"value":2347},"    X ",{"type":16,"tag":292,"props":2349,"children":2350},{"style":506},[2351],{"type":22,"value":509},{"type":16,"tag":292,"props":2353,"children":2354},{"style":305},[2355],{"type":22,"value":1109},{"type":16,"tag":292,"props":2357,"children":2358},{"style":512},[2359],{"type":22,"value":466},{"type":16,"tag":292,"props":2361,"children":2362},{"style":305},[2363],{"type":22,"value":1118},{"type":16,"tag":292,"props":2365,"children":2366},{"style":506},[2367],{"type":22,"value":1123},{"type":16,"tag":292,"props":2369,"children":2370},{"style":512},[2371],{"type":22,"value":466},{"type":16,"tag":292,"props":2373,"children":2374},{"style":305},[2375],{"type":22,"value":1132},{"type":16,"tag":292,"props":2377,"children":2378},{"style":531},[2379],{"type":22,"value":1137},{"type":16,"tag":292,"props":2381,"children":2382},{"style":305},[2383],{"type":22,"value":1142},{"type":16,"tag":292,"props":2385,"children":2387},{"class":294,"line":2386},32,[2388],{"type":16,"tag":292,"props":2389,"children":2390},{"style":1073},[2391],{"type":22,"value":2392},"    # (x, y, h, w)\n",{"type":16,"tag":292,"props":2394,"children":2396},{"class":294,"line":2395},33,[2397,2402,2406,2410,2414,2418,2422,2426,2430],{"type":16,"tag":292,"props":2398,"children":2399},{"style":305},[2400],{"type":22,"value":2401},"    y ",{"type":16,"tag":292,"props":2403,"children":2404},{"style":506},[2405],{"type":22,"value":509},{"type":16,"tag":292,"props":2407,"children":2408},{"style":305},[2409],{"type":22,"value":1109},{"type":16,"tag":292,"props":2411,"children":2412},{"style":512},[2413],{"type":22,"value":466},{"type":16,"tag":292,"props":2415,"children":2416},{"style":305},[2417],{"type":22,"value":1118},{"type":16,"tag":292,"props":2419,"children":2420},{"style":531},[2421],{"type":22,"value":1179},{"type":16,"tag":292,"props":2423,"children":2424},{"style":305},[2425],{"type":22,"value":471},{"type":16,"tag":292,"props":2427,"children":2428},{"style":531},[2429],{"type":22,"value":1137},{"type":16,"tag":292,"props":2431,"children":2432},{"style":305},[2433],{"type":22,"value":1142},{"type":16,"tag":292,"props":2435,"children":2437},{"class":294,"line":2436},34,[2438],{"type":16,"tag":292,"props":2439,"children":2440},{"emptyLinePlaceholder":369},[2441],{"type":22,"value":372},{"type":16,"tag":292,"props":2443,"children":2445},{"class":294,"line":2444},35,[2446],{"type":16,"tag":292,"props":2447,"children":2448},{"style":1073},[2449],{"type":22,"value":2450},"    # get the indices of the requested batch\n",{"type":16,"tag":292,"props":2452,"children":2454},{"class":294,"line":2453},36,[2455,2460,2464,2468,2472,2476,2480,2484,2488,2492,2496,2500,2504],{"type":16,"tag":292,"props":2456,"children":2457},{"style":305},[2458],{"type":22,"value":2459},"    indices ",{"type":16,"tag":292,"props":2461,"children":2462},{"style":506},[2463],{"type":22,"value":509},{"type":16,"tag":292,"props":2465,"children":2466},{"style":512},[2467],{"type":22,"value":840},{"type":16,"tag":292,"props":2469,"children":2470},{"style":305},[2471],{"type":22,"value":1227},{"type":16,"tag":292,"props":2473,"children":2474},{"style":506},[2475],{"type":22,"value":1123},{"type":16,"tag":292,"props":2477,"children":2478},{"style":512},[2479],{"type":22,"value":466},{"type":16,"tag":292,"props":2481,"children":2482},{"style":305},[2483],{"type":22,"value":1240},{"type":16,"tag":292,"props":2485,"children":2486},{"style":506},[2487],{"type":22,"value":1245},{"type":16,"tag":292,"props":2489,"children":2490},{"style":531},[2491],{"type":22,"value":1137},{"type":16,"tag":292,"props":2493,"children":2494},{"style":305},[2495],{"type":22,"value":1254},{"type":16,"tag":292,"props":2497,"children":2498},{"style":506},[2499],{"type":22,"value":1123},{"type":16,"tag":292,"props":2501,"children":2502},{"style":512},[2503],{"type":22,"value":466},{"type":16,"tag":292,"props":2505,"children":2506},{"style":305},[2507],{"type":22,"value":1267},{"type":16,"tag":292,"props":2509,"children":2511},{"class":294,"line":2510},37,[2512],{"type":16,"tag":292,"props":2513,"children":2514},{"emptyLinePlaceholder":369},[2515],{"type":22,"value":372},{"type":16,"tag":292,"props":2517,"children":2519},{"class":294,"line":2518},38,[2520,2525,2529,2533,2537],{"type":16,"tag":292,"props":2521,"children":2522},{"style":299},[2523],{"type":22,"value":2524},"    for",{"type":16,"tag":292,"props":2526,"children":2527},{"style":305},[2528],{"type":22,"value":1287},{"type":16,"tag":292,"props":2530,"children":2531},{"style":299},[2532],{"type":22,"value":1292},{"type":16,"tag":292,"props":2534,"children":2535},{"style":453},[2536],{"type":22,"value":1297},{"type":16,"tag":292,"props":2538,"children":2539},{"style":305},[2540],{"type":22,"value":1302},{"type":16,"tag":292,"props":2542,"children":2544},{"class":294,"line":2543},39,[2545,2550,2554,2558,2562],{"type":16,"tag":292,"props":2546,"children":2547},{"style":305},[2548],{"type":22,"value":2549},"      img_path ",{"type":16,"tag":292,"props":2551,"children":2552},{"style":506},[2553],{"type":22,"value":509},{"type":16,"tag":292,"props":2555,"children":2556},{"style":305},[2557],{"type":22,"value":1319},{"type":16,"tag":292,"props":2559,"children":2560},{"style":512},[2561],{"type":22,"value":466},{"type":16,"tag":292,"props":2563,"children":2564},{"style":305},[2565],{"type":22,"value":1328},{"type":16,"tag":292,"props":2567,"children":2569},{"class":294,"line":2568},40,[2570,2575,2579,2583],{"type":16,"tag":292,"props":2571,"children":2572},{"style":512},[2573],{"type":22,"value":2574},"                  self",{"type":16,"tag":292,"props":2576,"children":2577},{"style":305},[2578],{"type":22,"value":1341},{"type":16,"tag":292,"props":2580,"children":2581},{"style":531},[2582],{"type":22,"value":1346},{"type":16,"tag":292,"props":2584,"children":2585},{"style":305},[2586],{"type":22,"value":1351},{"type":16,"tag":292,"props":2588,"children":2590},{"class":294,"line":2589},41,[2591],{"type":16,"tag":292,"props":2592,"children":2593},{"emptyLinePlaceholder":369},[2594],{"type":22,"value":372},{"type":16,"tag":292,"props":2596,"children":2598},{"class":294,"line":2597},42,[2599,2604,2608],{"type":16,"tag":292,"props":2600,"children":2601},{"style":305},[2602],{"type":22,"value":2603},"      img ",{"type":16,"tag":292,"props":2605,"children":2606},{"style":506},[2607],{"type":22,"value":509},{"type":16,"tag":292,"props":2609,"children":2610},{"style":305},[2611],{"type":22,"value":1375},{"type":16,"tag":292,"props":2613,"children":2615},{"class":294,"line":2614},43,[2616,2620,2624,2629,2634,2639],{"type":16,"tag":292,"props":2617,"children":2618},{"style":305},[2619],{"type":22,"value":2603},{"type":16,"tag":292,"props":2621,"children":2622},{"style":506},[2623],{"type":22,"value":509},{"type":16,"tag":292,"props":2625,"children":2626},{"style":305},[2627],{"type":22,"value":2628}," cv2.cvtColor(img, cv2.",{"type":16,"tag":292,"props":2630,"children":2631},{"style":1772},[2632],{"type":22,"value":2633},"COLOR_RGB2GRAY",{"type":16,"tag":292,"props":2635,"children":2636},{"style":305},[2637],{"type":22,"value":2638},") ",{"type":16,"tag":292,"props":2640,"children":2641},{"style":1073},[2642],{"type":22,"value":2643},"# to reduce it to one channel to match the shape\n",{"type":16,"tag":292,"props":2645,"children":2647},{"class":294,"line":2646},44,[2648],{"type":16,"tag":292,"props":2649,"children":2650},{"style":1073},[2651],{"type":22,"value":2652},"      ## this is where you preprocess the image\n",{"type":16,"tag":292,"props":2654,"children":2656},{"class":294,"line":2655},45,[2657],{"type":16,"tag":292,"props":2658,"children":2659},{"style":1073},[2660],{"type":22,"value":2661},"      ## make sure to resize it to be self.output_size\n",{"type":16,"tag":292,"props":2663,"children":2665},{"class":294,"line":2664},46,[2666],{"type":16,"tag":292,"props":2667,"children":2668},{"emptyLinePlaceholder":369},[2669],{"type":22,"value":372},{"type":16,"tag":292,"props":2671,"children":2673},{"class":294,"line":2672},47,[2674,2679,2683,2687,2691,2695],{"type":16,"tag":292,"props":2675,"children":2676},{"style":305},[2677],{"type":22,"value":2678},"      label ",{"type":16,"tag":292,"props":2680,"children":2681},{"style":506},[2682],{"type":22,"value":509},{"type":16,"tag":292,"props":2684,"children":2685},{"style":512},[2686],{"type":22,"value":840},{"type":16,"tag":292,"props":2688,"children":2689},{"style":305},[2690],{"type":22,"value":1341},{"type":16,"tag":292,"props":2692,"children":2693},{"style":531},[2694],{"type":22,"value":1137},{"type":16,"tag":292,"props":2696,"children":2697},{"style":305},[2698],{"type":22,"value":1434},{"type":16,"tag":292,"props":2700,"children":2702},{"class":294,"line":2701},48,[2703],{"type":16,"tag":292,"props":2704,"children":2705},{"style":1073},[2706],{"type":22,"value":2707},"      ## if you have any preprocessing for\n",{"type":16,"tag":292,"props":2709,"children":2711},{"class":294,"line":2710},49,[2712],{"type":16,"tag":292,"props":2713,"children":2714},{"style":1073},[2715],{"type":22,"value":2716},"      ## the labels too do it here\n",{"type":16,"tag":292,"props":2718,"children":2720},{"class":294,"line":2719},50,[2721],{"type":16,"tag":292,"props":2722,"children":2723},{"emptyLinePlaceholder":369},[2724],{"type":22,"value":372},{"type":16,"tag":292,"props":2726,"children":2728},{"class":294,"line":2727},51,[2729,2734,2738],{"type":16,"tag":292,"props":2730,"children":2731},{"style":305},[2732],{"type":22,"value":2733},"      X[i,] ",{"type":16,"tag":292,"props":2735,"children":2736},{"style":506},[2737],{"type":22,"value":509},{"type":16,"tag":292,"props":2739,"children":2740},{"style":305},[2741],{"type":22,"value":1476},{"type":16,"tag":292,"props":2743,"children":2745},{"class":294,"line":2744},52,[2746,2751,2755],{"type":16,"tag":292,"props":2747,"children":2748},{"style":305},[2749],{"type":22,"value":2750},"      y[i] ",{"type":16,"tag":292,"props":2752,"children":2753},{"style":506},[2754],{"type":22,"value":509},{"type":16,"tag":292,"props":2756,"children":2757},{"style":305},[2758],{"type":22,"value":1494},{"type":16,"tag":292,"props":2760,"children":2762},{"class":294,"line":2761},53,[2763],{"type":16,"tag":292,"props":2764,"children":2765},{"emptyLinePlaceholder":369},[2766],{"type":22,"value":372},{"type":16,"tag":292,"props":2768,"children":2770},{"class":294,"line":2769},54,[2771,2775],{"type":16,"tag":292,"props":2772,"children":2773},{"style":299},[2774],{"type":22,"value":2238},{"type":16,"tag":292,"props":2776,"children":2777},{"style":305},[2778],{"type":22,"value":1515},{"type":16,"tag":292,"props":2780,"children":2782},{"class":294,"line":2781},55,[2783],{"type":16,"tag":292,"props":2784,"children":2785},{"emptyLinePlaceholder":369},[2786],{"type":22,"value":372},{"type":16,"tag":292,"props":2788,"children":2790},{"class":294,"line":2789},56,[2791],{"type":16,"tag":292,"props":2792,"children":2793},{"emptyLinePlaceholder":369},[2794],{"type":22,"value":372},{"type":16,"tag":292,"props":2796,"children":2798},{"class":294,"line":2797},57,[2799],{"type":16,"tag":292,"props":2800,"children":2801},{"style":1073},[2802],{"type":22,"value":2803},"## Defining and training the model\n",{"type":16,"tag":292,"props":2805,"children":2807},{"class":294,"line":2806},58,[2808],{"type":16,"tag":292,"props":2809,"children":2810},{"emptyLinePlaceholder":369},[2811],{"type":22,"value":372},{"type":16,"tag":292,"props":2813,"children":2815},{"class":294,"line":2814},59,[2816,2820,2824],{"type":16,"tag":292,"props":2817,"children":2818},{"style":305},[2819],{"type":22,"value":1574},{"type":16,"tag":292,"props":2821,"children":2822},{"style":506},[2823],{"type":22,"value":509},{"type":16,"tag":292,"props":2825,"children":2826},{"style":305},[2827],{"type":22,"value":1583},{"type":16,"tag":292,"props":2829,"children":2831},{"class":294,"line":2830},60,[2832],{"type":16,"tag":292,"props":2833,"children":2834},{"style":1073},[2835],{"type":22,"value":1591},{"type":16,"tag":292,"props":2837,"children":2839},{"class":294,"line":2838},61,[2840],{"type":16,"tag":292,"props":2841,"children":2842},{"style":305},[2843],{"type":22,"value":1351},{"type":16,"tag":292,"props":2845,"children":2847},{"class":294,"line":2846},62,[2848],{"type":16,"tag":292,"props":2849,"children":2850},{"emptyLinePlaceholder":369},[2851],{"type":22,"value":372},{"type":16,"tag":292,"props":2853,"children":2855},{"class":294,"line":2854},63,[2856,2860,2864,2868,2872,2876,2881,2886,2890,2894,2898,2903,2907,2911,2915,2919,2923,2927,2931],{"type":16,"tag":292,"props":2857,"children":2858},{"style":305},[2859],{"type":22,"value":1613},{"type":16,"tag":292,"props":2861,"children":2862},{"style":506},[2863],{"type":22,"value":509},{"type":16,"tag":292,"props":2865,"children":2866},{"style":305},[2867],{"type":22,"value":1622},{"type":16,"tag":292,"props":2869,"children":2870},{"style":544},[2871],{"type":22,"value":1627},{"type":16,"tag":292,"props":2873,"children":2874},{"style":305},[2875],{"type":22,"value":471},{"type":16,"tag":292,"props":2877,"children":2878},{"style":544},[2879],{"type":22,"value":2880},"\"data\"",{"type":16,"tag":292,"props":2882,"children":2883},{"style":305},[2884],{"type":22,"value":2885},", (",{"type":16,"tag":292,"props":2887,"children":2888},{"style":531},[2889],{"type":22,"value":1657},{"type":16,"tag":292,"props":2891,"children":2892},{"style":305},[2893],{"type":22,"value":471},{"type":16,"tag":292,"props":2895,"children":2896},{"style":531},[2897],{"type":22,"value":1657},{"type":16,"tag":292,"props":2899,"children":2900},{"style":305},[2901],{"type":22,"value":2902},"), ",{"type":16,"tag":292,"props":2904,"children":2905},{"style":1676},[2906],{"type":22,"value":524},{"type":16,"tag":292,"props":2908,"children":2909},{"style":506},[2910],{"type":22,"value":509},{"type":16,"tag":292,"props":2912,"children":2913},{"style":531},[2914],{"type":22,"value":178},{"type":16,"tag":292,"props":2916,"children":2917},{"style":305},[2918],{"type":22,"value":471},{"type":16,"tag":292,"props":2920,"children":2921},{"style":1676},[2922],{"type":22,"value":503},{"type":16,"tag":292,"props":2924,"children":2925},{"style":506},[2926],{"type":22,"value":509},{"type":16,"tag":292,"props":2928,"children":2929},{"style":512},[2930],{"type":22,"value":1708},{"type":16,"tag":292,"props":2932,"children":2933},{"style":305},[2934],{"type":22,"value":1713},{"type":16,"tag":292,"props":2936,"children":2938},{"class":294,"line":2937},64,[2939],{"type":16,"tag":292,"props":2940,"children":2941},{"emptyLinePlaceholder":369},[2942],{"type":22,"value":372},{"type":16,"tag":292,"props":2944,"children":2946},{"class":294,"line":2945},65,[2947],{"type":16,"tag":292,"props":2948,"children":2949},{"style":1073},[2950],{"type":22,"value":1728},{"type":16,"tag":292,"props":2952,"children":2954},{"class":294,"line":2953},66,[2955],{"type":16,"tag":292,"props":2956,"children":2957},{"emptyLinePlaceholder":369},[2958],{"type":22,"value":372},{"type":16,"tag":292,"props":2960,"children":2962},{"class":294,"line":2961},67,[2963],{"type":16,"tag":292,"props":2964,"children":2965},{"style":1073},[2966],{"type":22,"value":1743},{"type":16,"tag":292,"props":2968,"children":2970},{"class":294,"line":2969},68,[2971,2975,2979,2983,2987,2991,2995],{"type":16,"tag":292,"props":2972,"children":2973},{"style":305},[2974],{"type":22,"value":1751},{"type":16,"tag":292,"props":2976,"children":2977},{"style":1676},[2978],{"type":22,"value":1756},{"type":16,"tag":292,"props":2980,"children":2981},{"style":506},[2982],{"type":22,"value":509},{"type":16,"tag":292,"props":2984,"children":2985},{"style":531},[2986],{"type":22,"value":1765},{"type":16,"tag":292,"props":2988,"children":2989},{"style":305},[2990],{"type":22,"value":471},{"type":16,"tag":292,"props":2992,"children":2993},{"style":1772},[2994],{"type":22,"value":195},{"type":16,"tag":292,"props":2996,"children":2997},{"style":305},[2998],{"type":22,"value":1713},{"type":16,"tag":25,"props":3000,"children":3001},{},[],{"type":16,"tag":36,"props":3003,"children":3004},{},[3005,3007,3010],{"type":22,"value":3006},"And that's it.. you've just created your dataset generator that loads the data into memory batch by batch instead of the whole thing at once.",{"type":16,"tag":50,"props":3008,"children":3009},{},[],{"type":22,"value":3011},"\nI hope this was useful.",{"type":16,"tag":25,"props":3013,"children":3014},{},[],{"type":16,"tag":36,"props":3016,"children":3017},{},[3018],{"type":16,"tag":81,"props":3019,"children":3022},{"className":3020,"href":3021},[84],"https://stanford.edu/~shervine/blog/keras-how-to-generate-data-on-the-fly",[3023],{"type":22,"value":3024},"Reference Article",{"type":16,"tag":36,"props":3026,"children":3027},{},[3028],{"type":16,"tag":81,"props":3029,"children":3032},{"className":3030,"href":3031},[84],"https://github.com/mahmoudyusof/facial_keypoint_detection",[3033],{"type":22,"value":3034},"My Notebooks",{"type":16,"tag":3036,"props":3037,"children":3038},"style",{},[3039],{"type":22,"value":3040},"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":7,"searchDepth":321,"depth":321,"links":3042},[3043,3044,3045,3046,3047,3048],{"id":31,"depth":321,"text":34},{"id":57,"depth":321,"text":60},{"id":96,"depth":321,"text":99},{"id":112,"depth":321,"text":115},{"id":72,"depth":321,"text":242},{"id":1815,"depth":321,"text":1818},"markdown","content:blog:1.datagenerator.md","content","blog/1.datagenerator.md","md",1718374936368]
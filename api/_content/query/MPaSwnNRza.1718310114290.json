{"_path":"/blog/datagenerator","_dir":"blog","_draft":false,"_partial":false,"_locale":"","title":"Data Generators In Tensorflow","description":"explaining how to load batches of data into memory instead of the entire dataset for more effeciency","project":"facial-keypoint-detection","slug":"data-generator","type":"article","image":"/memory.jpg","url":"https://mahmoudyusof.github.io/facial-keypoint-detection/data-generator/","date":"2020-05-25","body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"how-to-use-data-generators-in-tensorflow"},"children":[{"type":"text","value":"How to use data generators in tensorflow"}]},{"type":"element","tag":"hr","props":{},"children":[]},{"type":"element","tag":"h2","props":{"id":"why"},"children":[{"type":"text","value":"Why ?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Believe it or not, but loading the entire dataset in memory is "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"NOT"}]},{"type":"text","value":" the best idea."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nIf you're dealing with a small dataset, that might work, but that is just a waste of resources, and worse if you're working on a huge dataset like the imageNet dataset, this won't work at all."}]},{"type":"element","tag":"h2","props":{"id":"how"},"children":[{"type":"text","value":"HOW ?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Python generators are lazy which means they are iterables that give you the data upon request, unlike regular lists that just store the data in memory all the time."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"tensorflow keras has a "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Sequence"}]},{"type":"text","value":" class that can be used for this purpose. "},{"type":"element","tag":"a","props":{"className":["mdlink"],"href":"https://www.tensorflow.org/api_docs/python/tf/keras/utils/Sequence"},"children":[{"type":"text","value":"Sequence Class API Reference"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nlet's jump into it"}]},{"type":"element","tag":"h2","props":{"id":"scenario"},"children":[{"type":"text","value":"Scenario"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Working with images is a good example for this, so let's say that you have pictures of objects that you need to localize,"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nSo your features are images and labels are (x, y, h, w) for coordinate and dimensions of the containing box, and the labels and image names are stored in a csv file."}]},{"type":"element","tag":"h2","props":{"id":"data"},"children":[{"type":"text","value":"Data"}]},{"type":"text","value":"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{"type":"element","tag":"table","props":{},"children":[{"type":"element","tag":"thead","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"image_file    "}]},{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"x    "}]},{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"y    "}]},{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"w    "}]},{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"h    "}]}]}]},{"type":"element","tag":"tbody","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"file1.png"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"10"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"20"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"50"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"50"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"..."}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"..."}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"..."}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"..."}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"..."}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"..."}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"..."}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"..."}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"..."}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"..."}]}]}]}]},{"type":"element","tag":"hr","props":{},"children":[]},{"type":"element","tag":"h2","props":{"id":"code"},"children":[{"type":"text","value":"Code"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Let's define an initializer, the initializer is going to take the information needed to get the data such as:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The csv file"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The directory containing all of the images"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It will also take the output shape of the batch"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The output size of each image"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The batch size"}]}]},{"type":"element","tag":"pre","props":{"className":"language-python shiki shiki-themes dark-plus github-dark","code":"import numpy as np\nimport pandas as pd\nimport matplotlib.image as mpimg\n\nfrom tensorflow.keras.utils import Sequence\n\nclass DataGenerator(Sequence):\n\n  def __init__(self, csv_file, base_dir, output_size, shuffle=False, batch_size=10):\n  \"\"\"\n  Initializes a data generator object\n    :param csv_file: file in which image names and numeric labels are stored\n    :param base_dir: the directory in which all images are stored\n    :param output_size: image output size after preprocessing\n    :param shuffle: shuffle the data after each epoch\n    :param batch_size: The size of each batch returned by __getitem__\n  \"\"\"\n    self.df = pd.read_csv(csv_file)\n    self.base_dir = base_dir\n    self.output_size = output_size\n    self.shuffle = shuffle\n    self.batch_size = batch_size\n    self.on_epoch_end()\n\n\n","language":"python","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C586C0;--shiki-dark:#F97583"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" numpy "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C586C0;--shiki-dark:#F97583"},"children":[{"type":"text","value":"as"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" np\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C586C0;--shiki-dark:#F97583"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" pandas "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C586C0;--shiki-dark:#F97583"},"children":[{"type":"text","value":"as"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" pd\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C586C0;--shiki-dark:#F97583"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" matplotlib.image "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C586C0;--shiki-dark:#F97583"},"children":[{"type":"text","value":"as"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" mpimg\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C586C0;--shiki-dark:#F97583"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" tensorflow.keras.utils "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C586C0;--shiki-dark:#F97583"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" Sequence\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#F97583"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#4EC9B0;--shiki-dark:#B392F0"},"children":[{"type":"text","value":" DataGenerator"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#4EC9B0;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"Sequence"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"):\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#F97583"},"children":[{"type":"text","value":"  def"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#DCDCAA;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" __init__"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9CDCFE;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9CDCFE;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"csv_file"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9CDCFE;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"base_dir"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9CDCFE;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"output_size"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9CDCFE;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"shuffle"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"False"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9CDCFE;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"batch_size"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B5CEA8;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"10"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"):\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#CE9178;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"  \"\"\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#CE9178;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"  Initializes a data generator object\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#CE9178;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"    :param csv_file: file in which image names and numeric labels are stored\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#CE9178;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"    :param base_dir: the directory in which all images are stored\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#CE9178;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"    :param output_size: image output size after preprocessing\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#CE9178;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"    :param shuffle: shuffle the data after each epoch\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#CE9178;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"    :param batch_size: The size of each batch returned by __getitem__\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#CE9178;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"  \"\"\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"    self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".df "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" pd.read_csv(csv_file)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"    self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".base_dir "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" base_dir\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"    self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".output_size "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" output_size\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"    self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".shuffle "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" shuffle\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"    self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".batch_size "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" batch_size\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"    self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".on_epoch_end()\n"}]}]}]}]},{"type":"element","tag":"hr","props":{},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now let's define some special methods starting with the one called in the initializer "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"on_epoch_end()"}]},{"type":"text","value":" that is called after each epoch as the name may suggest, duh!"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We call this method in the initializer because we need the indeces attribute to be set at the begining of the first epoch, otherwise we will get an error telling us that the class has no attribute \"indecies\""}]},{"type":"element","tag":"pre","props":{"className":"language-python shiki shiki-themes dark-plus github-dark","code":"def on_epoch_end(self):\n  self.indices = np.arange(len(self.df))\n  if self.shuffle:\n    np.random.shuffle(self.indices)\n\n\n","language":"python","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#F97583"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#DCDCAA;--shiki-dark:#B392F0"},"children":[{"type":"text","value":" on_epoch_end"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9CDCFE;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"):\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"  self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".indices "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" np.arange("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#DCDCAA;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"len"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".df))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C586C0;--shiki-dark:#F97583"},"children":[{"type":"text","value":"  if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".shuffle:\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    np.random.shuffle("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".indices)\n"}]}]}]}]},{"type":"element","tag":"hr","props":{},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now we need to define the length of the data, which is not the number of entries as you might think, it's actually the number of batches, this needs to be accessible by the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"len"}]},{"type":"text","value":" function in python so we need to define the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"__len__"}]},{"type":"text","value":" method."}]},{"type":"element","tag":"pre","props":{"className":"language-python shiki shiki-themes dark-plus github-dark","code":"def __len__(self):\n  return int(len(self.df) / self.batch_size)\n\n\n","language":"python","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#F97583"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#DCDCAA;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" __len__"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9CDCFE;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"):\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C586C0;--shiki-dark:#F97583"},"children":[{"type":"text","value":"  return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#4EC9B0;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" int"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#DCDCAA;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"len"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".df) "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".batch_size)\n"}]}]}]}]},{"type":"element","tag":"hr","props":{},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now let's get serious, the fun part is in the next method which is "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"__getitem__"}]},{"type":"text","value":"."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nThis function gets called on indexing or slicing like "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"data_generator[0]"}]},{"type":"text","value":" or "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"data_generator[1:3]"}]},{"type":"text","value":" and the index is passed as a parameter to it. Here we call it "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"idx"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In this function we shall load and preprocess the images."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nThis will only be fired when keras trys to load a batch, which will save our memory."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You might think splitting this into multiple functions would be a good idea ... and you'd be totally right."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nThis function should return a preprocessed batch of data"}]},{"type":"element","tag":"pre","props":{"className":"language-python shiki shiki-themes dark-plus github-dark","code":"def __getitem__(self, idx):\n  ## Initializing Batch\n  #  that one in the shape is just for a one channel images\n  # if you want to use colored images you might want to set that to 3\n  X = np.empty((self.batch_size, *self.output_size, 1))\n  # (x, y, h, w)\n  y = np.empty((self.batch_size, 4, 1))\n\n  # get the indices of the requested batch\n  indices = self.indices[idx*self.batch_size:(idx+1)*self.batch_size]\n\n  for i, data_index in enumerate(indices):\n    img_path = os.path.join(self.base_dir,\n                self.df.iloc[data_index, 0])\n\n    img = mpimg.imread()\n\n    ## this is where you preprocess the image\n    ## make sure to resize it to be self.output_size\n\n    label = self.df.iloc[data_index, 1:].to_numpy()\n    ## if you have any preprocessing for\n    ## the labels too do it here\n\n    X[i,] = img\n    y[i] = label\n\n  return X, y\n\n\n","language":"python","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#F97583"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#DCDCAA;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" __getitem__"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9CDCFE;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9CDCFE;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"idx"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"):\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A9955;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"  ## Initializing Batch\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A9955;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"  #  that one in the shape is just for a one channel images\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A9955;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"  # if you want to use colored images you might want to set that to 3\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  X "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" np.empty(("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".batch_size, "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".output_size, "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B5CEA8;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A9955;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"  # (x, y, h, w)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  y "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" np.empty(("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".batch_size, "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B5CEA8;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"4"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B5CEA8;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A9955;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"  # get the indices of the requested batch\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  indices "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".indices[idx"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".batch_size:(idx"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B5CEA8;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":")"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".batch_size]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C586C0;--shiki-dark:#F97583"},"children":[{"type":"text","value":"  for"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" i, data_index "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C586C0;--shiki-dark:#F97583"},"children":[{"type":"text","value":"in"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#DCDCAA;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" enumerate"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"(indices):\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    img_path "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" os.path.join("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".base_dir,\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"                self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".df.iloc[data_index, "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B5CEA8;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"])\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    img "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" mpimg.imread()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A9955;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"    ## this is where you preprocess the image\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A9955;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"    ## make sure to resize it to be self.output_size\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    label "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".df.iloc[data_index, "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B5CEA8;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":].to_numpy()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A9955;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"    ## if you have any preprocessing for\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A9955;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"    ## the labels too do it here\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    X[i,] "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" img\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    y[i] "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" label\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C586C0;--shiki-dark:#F97583"},"children":[{"type":"text","value":"  return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" X, y\n"}]}]}]}]},{"type":"element","tag":"hr","props":{},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now you are ready to fit the model to this generator. You can also easily make a validation generator and validate your model against that, all you need to do is make a new instance of the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"DataGenerator"}]},{"type":"text","value":" class, and pass in the validation csv and base directory and you're good to go. That's why I love OOP."}]},{"type":"element","tag":"pre","props":{"className":"language-python shiki shiki-themes dark-plus github-dark","code":"from tensorflow.keras.models import Sequential\n\nmodel = Sequential([\n  ## define the model's architecture\n])\n\ntrain_gen = DataGenerator(\"data.csv\",\n                          \"data\",\n                          (244, 244),\n                          batch_size=20,\n                          shuffle=True)\n\n## compile the model first of course\n\n# now let's train the model\nmodel.fit(train_gen, epochs=5, ...)\n#  note you could also make a validation generator and pass it here like normal datasets\n\n# back in the days you had to do this\n# model.fit_generator(train_gen, ...)\n\n\n","language":"python","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C586C0;--shiki-dark:#F97583"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" tensorflow.keras.models "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C586C0;--shiki-dark:#F97583"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" Sequential\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"model "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" Sequential([\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A9955;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"  ## define the model's architecture\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"])\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"train_gen "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" DataGenerator("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#CE9178;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"data.csv\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#CE9178;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"                          \"data\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"                          ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B5CEA8;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"244"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B5CEA8;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"244"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"),\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#9CDCFE;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"                          batch_size"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B5CEA8;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"20"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#9CDCFE;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"                          shuffle"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"True"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A9955;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"## compile the model first of course\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A9955;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# now let's train the model\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"model.fit(train_gen, "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9CDCFE;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"epochs"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B5CEA8;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"5"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"..."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A9955;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"#  note you could also make a validation generator and pass it here like normal datasets\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A9955;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# back in the days you had to do this\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A9955;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# model.fit_generator(train_gen, ...)\n"}]}]}]}]},{"type":"element","tag":"hr","props":{},"children":[]},{"type":"element","tag":"h2","props":{"id":"the-complete-code"},"children":[{"type":"text","value":"The complete code"}]},{"type":"element","tag":"pre","props":{"className":"language-python shiki shiki-themes dark-plus github-dark","code":"class DataGenerator(Sequence):\n\n  def __init__(self, csv_file, base_dir, output_size, shuffle=False, batch_size=10):\n    \"\"\"\n    Initializes a data generator object\n      :param csv_file: file in which image names and numeric labels are stored\n      :param base_dir: the directory in which all images are stored\n      :param output_size: image output size after preprocessing\n      :param shuffle: shuffle the data after each epoch\n      :param batch_size: The size of each batch returned by __getitem__\n    \"\"\"\n    self.df = pd.read_csv(csv_file)\n    self.base_dir = base_dir\n    self.output_size = output_size\n    self.shuffle = shuffle\n    self.batch_size = batch_size\n    self.on_epoch_end()\n\n  def on_epoch_end(self):\n    self.indices = np.arange(len(self.df))\n    if self.shuffle:\n      np.random.shuffle(self.indices)\n\n  def __len__(self):\n    return int(len(self.df) / self.batch_size)\n\n  def __getitem__(self, idx):\n    ## Initializing Batch\n    #  that one in the shape is just for a one channel images\n    # if you want to use colored images you might want to set that to 3\n    X = np.empty((self.batch_size, *self.output_size, 1))\n    # (x, y, h, w)\n    y = np.empty((self.batch_size, 4, 1))\n\n    # get the indices of the requested batch\n    indices = self.indices[idx*self.batch_size:(idx+1)*self.batch_size]\n\n    for i, data_index in enumerate(indices):\n      img_path = os.path.join(self.base_dir,\n                  self.df.iloc[data_index, 0])\n\n      img = mpimg.imread()\n      img = cv2.cvtColor(img, cv2.COLOR_RGB2GRAY) # to reduce it to one channel to match the shape\n      ## this is where you preprocess the image\n      ## make sure to resize it to be self.output_size\n\n      label = self.df.iloc[data_index, 1:].to_numpy()\n      ## if you have any preprocessing for\n      ## the labels too do it here\n\n      X[i,] = img\n      y[i] = label\n\n    return X, y\n\n\n## Defining and training the model\n\nmodel = Sequential([\n  ## define the model's architecture\n])\n\ntrain_gen = DataGenerator(\"data.csv\", \"data\", (244, 244), batch_size=20, shuffle=True)\n\n## compile the model first of course\n\n# now let's train the model\nmodel.fit(train_gen, epochs=5, ...)\n\n\n","language":"python","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#F97583"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#4EC9B0;--shiki-dark:#B392F0"},"children":[{"type":"text","value":" DataGenerator"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#4EC9B0;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"Sequence"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"):\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#F97583"},"children":[{"type":"text","value":"  def"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#DCDCAA;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" __init__"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9CDCFE;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9CDCFE;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"csv_file"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9CDCFE;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"base_dir"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9CDCFE;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"output_size"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9CDCFE;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"shuffle"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"False"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9CDCFE;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"batch_size"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B5CEA8;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"10"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"):\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#CE9178;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"    \"\"\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#CE9178;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"    Initializes a data generator object\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#CE9178;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"      :param csv_file: file in which image names and numeric labels are stored\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#CE9178;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"      :param base_dir: the directory in which all images are stored\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#CE9178;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"      :param output_size: image output size after preprocessing\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#CE9178;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"      :param shuffle: shuffle the data after each epoch\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#CE9178;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"      :param batch_size: The size of each batch returned by __getitem__\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#CE9178;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"    \"\"\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"    self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".df "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" pd.read_csv(csv_file)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"    self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".base_dir "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" base_dir\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"    self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".output_size "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" output_size\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"    self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".shuffle "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" shuffle\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"    self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".batch_size "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" batch_size\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"    self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".on_epoch_end()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#F97583"},"children":[{"type":"text","value":"  def"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#DCDCAA;--shiki-dark:#B392F0"},"children":[{"type":"text","value":" on_epoch_end"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9CDCFE;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"):\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"    self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".indices "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" np.arange("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#DCDCAA;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"len"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".df))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C586C0;--shiki-dark:#F97583"},"children":[{"type":"text","value":"    if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".shuffle:\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"      np.random.shuffle("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".indices)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#F97583"},"children":[{"type":"text","value":"  def"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#DCDCAA;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" __len__"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9CDCFE;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"):\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C586C0;--shiki-dark:#F97583"},"children":[{"type":"text","value":"    return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#4EC9B0;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" int"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#DCDCAA;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"len"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".df) "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".batch_size)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#F97583"},"children":[{"type":"text","value":"  def"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#DCDCAA;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" __getitem__"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9CDCFE;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9CDCFE;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"idx"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"):\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A9955;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"    ## Initializing Batch\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":29},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A9955;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"    #  that one in the shape is just for a one channel images\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":30},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A9955;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"    # if you want to use colored images you might want to set that to 3\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":31},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    X "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" np.empty(("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".batch_size, "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".output_size, "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B5CEA8;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":32},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A9955;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"    # (x, y, h, w)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":33},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    y "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" np.empty(("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".batch_size, "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B5CEA8;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"4"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B5CEA8;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":34},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":35},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A9955;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"    # get the indices of the requested batch\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":36},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    indices "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".indices[idx"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".batch_size:(idx"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B5CEA8;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":")"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".batch_size]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":37},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":38},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C586C0;--shiki-dark:#F97583"},"children":[{"type":"text","value":"    for"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" i, data_index "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C586C0;--shiki-dark:#F97583"},"children":[{"type":"text","value":"in"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#DCDCAA;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" enumerate"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"(indices):\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":39},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"      img_path "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" os.path.join("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".base_dir,\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":40},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"                  self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".df.iloc[data_index, "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B5CEA8;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"])\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":41},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":42},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"      img "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" mpimg.imread()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":43},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"      img "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" cv2.cvtColor(img, cv2."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"COLOR_RGB2GRAY"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A9955;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# to reduce it to one channel to match the shape\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":44},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A9955;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"      ## this is where you preprocess the image\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":45},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A9955;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"      ## make sure to resize it to be self.output_size\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":46},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":47},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"      label "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":".df.iloc[data_index, "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B5CEA8;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":].to_numpy()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":48},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A9955;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"      ## if you have any preprocessing for\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":49},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A9955;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"      ## the labels too do it here\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":50},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":51},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"      X[i,] "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" img\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":52},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"      y[i] "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" label\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":53},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":54},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C586C0;--shiki-dark:#F97583"},"children":[{"type":"text","value":"    return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" X, y\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":55},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":56},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":57},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A9955;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"## Defining and training the model\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":58},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":59},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"model "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" Sequential([\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":60},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A9955;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"  ## define the model's architecture\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":61},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"])\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":62},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":63},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"train_gen "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" DataGenerator("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#CE9178;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"data.csv\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#CE9178;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"data\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":", ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B5CEA8;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"244"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B5CEA8;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"244"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"), "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9CDCFE;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"batch_size"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B5CEA8;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"20"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9CDCFE;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"shuffle"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#569CD6;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"True"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":64},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":65},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A9955;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"## compile the model first of course\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":66},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":67},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A9955;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# now let's train the model\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":68},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"model.fit(train_gen, "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9CDCFE;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"epochs"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B5CEA8;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"5"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"..."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D4D4D4;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":")\n"}]}]}]}]},{"type":"element","tag":"hr","props":{},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"And that's it.. you've just created your dataset generator that loads the data into memory batch by batch instead of the whole thing at once."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nI hope this was useful."}]},{"type":"element","tag":"hr","props":{},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"className":["mdlink"],"href":"https://stanford.edu/~shervine/blog/keras-how-to-generate-data-on-the-fly"},"children":[{"type":"text","value":"Reference Article"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"className":["mdlink"],"href":"https://github.com/mahmoudyusof/facial_keypoint_detection"},"children":[{"type":"text","value":"My Notebooks"}]}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"why","depth":2,"text":"Why ?"},{"id":"how","depth":2,"text":"HOW ?"},{"id":"scenario","depth":2,"text":"Scenario"},{"id":"data","depth":2,"text":"Data"},{"id":"code","depth":2,"text":"Code"},{"id":"the-complete-code","depth":2,"text":"The complete code"}]}},"_type":"markdown","_id":"content:blog:1.datagenerator.md","_source":"content","_file":"blog/1.datagenerator.md","_extension":"md"}